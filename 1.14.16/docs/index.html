<!DOCTYPE html>
<html  dir="ltr">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>АТОЛ. JPOS-драйвер v.1.14.16</title>
        <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
        <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.26.4/css/uikit.gradient.css">

        <link rel="stylesheet" href="style.css">
        <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
        <script src="uikit.js"></script>
        <script src="scripts.js"></script>
        <script src="jquery.sticky-kit.js "></script>

        <meta name="generator" content="pandoc-uikit" />
                        <title>АТОЛ. JPOS-драйвер v.1.14.16</title>
        <style type="text/css">code{white-space: pre;}</style>
                        <style type="text/css">
            a.sourceLine { display: inline-block; line-height: 1.25; }
            a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
            a.sourceLine:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode { white-space: pre; position: relative; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            code.sourceCode { white-space: pre-wrap; }
            a.sourceLine { text-indent: -1em; padding-left: 1em; }
            }
            pre.numberSource a.sourceLine
              { position: relative; left: -4em; }
            pre.numberSource a.sourceLine::before
              { content: attr(data-line-number);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; pointer-events: all; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {  }
            @media screen {
            a.sourceLine::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        </style>
                        <link rel="stylesheet" href="docs/uikit.css" />
                                              </head>

    <body>


        <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">

                        <div class="uk-grid" data-uk-grid-margin>
                <div class="uk-width-1-1">
                    <h1 class="uk-heading-large">АТОЛ. JPOS-драйвер v.1.14.16</h1>
                                                        </div>
            </div>
            
            <div class="uk-grid" data-uk-grid-margin >          
                <div class="uk-width-medium-1-4">
                    <div class="uk-overflow-container" data-uk-sticky="{top:25,media: 768}">
                        <div class="uk-panel uk-panel-box menu-begin" >

                                                        <ul>
                            <li><a href="#настройка-драйвера">Настройка драйвера</a></li>
                            <li><a href="#поддержка-стандартных-операций">Поддержка стандартных операций</a><ul>
                            <li><a href="#регистрация-кассира">Регистрация кассира</a></li>
                            <li><a href="#печать-чека">Печать чека</a></li>
                            <li><a href="#закрытие-смены">Закрытие смены</a></li>
                            <li><a href="#печать-x-отчета">Печать X-отчета</a></li>
                            <li><a href="#печать-отчета-о-состоянии-расчетов">Печать отчета о состоянии расчетов</a></li>
                            <li><a href="#внесения-выплаты">Внесения / выплаты</a></li>
                            <li><a href="#нефискальные-документы">Нефискальные документы</a></li>
                            <li><a href="#запросы-информации-о-ккт-и-драйвере">Запросы информации о ККТ и драйвере</a></li>
                            <li><a href="#запросы-состояния">Запросы состояния</a></li>
                            <li><a href="#запросы-счетчиков">Запросы счетчиков</a></li>
                            </ul></li>
                            <li><a href="#обработка-ошибок">Обработка ошибок</a></li>
                            <li><a href="#расширенный-функционал-directio">Расширенный функционал (directIO)</a><ul>
                            <li><a href="#печать-текста-с-форматированием">1001 - печать текста с форматированием</a></li>
                            <li><a href="#печать-штрихкода-2">1002 - печать штрихкода</a></li>
                            <li><a href="#открытие-смены">1003 - открытие смены</a></li>
                            <li><a href="#чтение-настройки-ккт">1004 - чтение настройки ККТ</a></li>
                            <li><a href="#запись-настройки-ккт">1005 - запись настройки ККТ</a></li>
                            <li><a href="#применить-настройки-ккт">1006 - применить настройки ККТ</a></li>
                            <li><a href="#запрос-информации-о-последнем-документе">1007 - запрос информации о последнем документе</a></li>
                            <li><a href="#запрос-квитанции-офд">1008 - запрос квитанции ОФД</a></li>
                            <li><a href="#отключение-печати-чека-или-отчёта">1009 - отключение печати чека или отчёта</a></li>
                            <li><a href="#добавление-реквизита-чека">1010 - добавление реквизита чека</a></li>
                            <li><a href="#добавление-реквизита-позиции">1011 - добавление реквизита позиции</a></li>
                            <li><a href="#открыть-денежный-ящик">1012 - открыть денежный ящик</a></li>
                            <li><a href="#статус-денежного-ящика">1013 - статус денежного ящика</a></li>
                            <li><a href="#печать-документа-из-фн-по-номеру">1014 - печать документа из ФН по номеру</a></li>
                            <li><a href="#чтение-даты-и-времени-с-точностью-до-секунд">1015 - чтение даты и времени (с точностью до секунд)</a></li>
                            <li><a href="#запись-даты-и-времени-с-точностью-до-секунд">1016 - запись даты и времени (с точностью до секунд)</a></li>
                            <li><a href="#чтение-реквизитов-регистрации-ккт">1017 - чтение реквизитов регистрации ККТ</a></li>
                            <li><a href="#чтение-сменных-счетчиков">1020 - чтение сменных счетчиков</a></li>
                            <li><a href="#чтение-необнуляемых-итогов">1021 - чтение необнуляемых итогов</a></li>
                            <li><a href="#запрос-информации-о-фн">1022 - запрос информации о ФН</a></li>
                            <li><a href="#запрос-статуса-обмена-с-офд">1023 - запрос статуса обмена с ОФД</a></li>
                            <li><a href="#запрос-срока-действия-фн">1024 - запрос срока действия ФН</a></li>
                            <li><a href="#запись-произвольного-поля-в-json-чека">1025 - запись произвольного поля в JSON чека</a></li>
                            <li><a href="#регистрация-налога-на-чек-1">1026 - регистрация налога на чек</a></li>
                            <li><a href="#установка-инн-кассира">1027 - установка ИНН кассира</a></li>
                            <li><a href="#запись-кода-табачной-продукции">1029 - запись кода табачной продукции</a></li>
                            <li><a href="#запись-кода-лекарства">1030 - запись кода лекарства</a></li>
                            <li><a href="#запись-кода-меховой-продукции">1031 - запись кода меховой продукции</a></li>
                            <li><a href="#запрос-суммы-налогов-за-последний-чек">1032 - запрос суммы налогов за последний чек</a></li>
                            <li><a href="#регистрация-налога-на-позицию">1033 - регистрация налога на позицию</a></li>
                            <li><a href="#перевод-чека-в-режим-ндс18">1034 - перевод чека в режим НДС18</a></li>
                            <li><a href="#запрос-состояния-смены">1035 - запрос состояния смены</a></li>
                            <li><a href="#запрос-статуса">1036 - запрос статуса</a></li>
                            <li><a href="#запись-кода-обуви">1037 - запись кода обуви</a></li>
                            <li><a href="#установка-имени-кассира">1038 - установка имени кассира</a></li>
                            <li><a href="#запись-сырого-кода-маркировки">1039 - запись “сырого” кода маркировки</a></li>
                            <li><a href="#запись-неразобранной-марки">1040 - запись неразобранной марки</a></li>
                            <li><a href="#добавление-текста-для-печати-рядом-со-штрихкодом">1041 - добавление текста для печати рядом со штрихкодом</a></li>
                            <li><a href="#запрос-версии-шаблонов">1042 - запрос версии шаблонов</a></li>
                            <li><a href="#загрузка-контейнера">1043 - загрузка контейнера</a></li>
                            <li><a href="#загрузка-шаблонов">1044 - загрузка шаблонов</a></li>
                            <li><a href="#загрузка-лицензий">1045 - загрузка лицензий</a></li>
                            <li><a href="#загрузка-лицензий-из-файла">1046 - загрузка лицензий из файла</a></li>
                            <li><a href="#загрузка-лицензий-из-данных-файла">1047 - загрузка лицензий из данных файла</a></li>
                            <li><a href="#считывание-лицензий">1048 - считывание лицензий</a></li>
                            <li><a href="#запись-неразобранной-марки-ффд-1.2-в-позицию-чека">1049 - запись неразобранной марки (ФФД 1.2) в позицию чека</a></li>
                            <li><a href="#очистка-буфера-запросов-на-проверку-марок">1050 - очистка буфера запросов на проверку марок</a></li>
                            <li><a href="#добавление-марки-для-проверки">1051 - добавление марки для проверки</a></li>
                            <li><a href="#проверка-марок">1052 - проверка марок</a></li>
                            <li><a href="#получение-результатов-проверки-марок">1053 - получение результатов проверки марок</a></li>
                            <li><a href="#обновление-ключей-фн-м">1054 - обновление ключей ФН-М</a></li>
                            <li><a href="#передача-отраслевого-реквизита-предмета-расчёта-тег-1260">1055 - передача отраслевого реквизита предмета расчёта (тег 1260)</a></li>
                            <li><a href="#передача-отраслевого-реквизита-чека-тег-1261">1056 - передача отраслевого реквизита чека (тег 1261)</a></li>
                            <li><a href="#передача-дополнительного-операционного-реквизита-чека-тег-1270">1057 - передача дополнительного операционного реквизита чека (тег 1270)</a></li>
                            <li><a href="#начать-проверку-марки">1058 - начать проверку марки</a></li>
                            <li><a href="#результат-проверки-марки">1059 - результат проверки марки</a></li>
                            <li><a href="#прерывание-проверки-марки">1060 - прерывание проверки марки</a></li>
                            <li><a href="#подтверждение-реализации-маркированного-товара">1061 - подтверждение реализации маркированного товара</a></li>
                            <li><a href="#отказ-от-реализации-маркированного-товара">1062 - отказ от реализации маркированного товара</a></li>
                            <li><a href="#очистка-буфера-проверки-марок-в-фн">1063 - очистка буфера проверки марок в ФН</a></li>
                            <li><a href="#добавление-кода-товара">1064 - добавление кода товара</a></li>
                            <li><a href="#запрос-состояния-работы-с-км">1065 - запрос состояния работы с КМ</a></li>
                            <li><a href="#запрос-состояния-очереди-отправки">1066 - запрос состояния очереди отправки</a></li>
                            <li><a href="#проверка-связи-с-сервером-исм">1067 - проверка связи с сервером ИСМ</a></li>
                            <li><a href="#запрос-статуса-обмена-с-исм">1068 - запрос статуса обмена с ИСМ</a></li>
                            <li><a href="#запрос-ресурса-отрезчика-и-тпг">1069 - запрос ресурса отрезчика и ТПГ</a></li>
                            <li><a href="#запрос-признака-некорректных-кодов-маркировки">1070 - запрос признака некорректных кодов маркировки</a></li>
                            <li><a href="#добавление-марок-в-таблицу-проверенных-км">1071 - добавление марок в таблицу проверенных КМ</a></li>
                            <li><a href="#получение-результатов-добавления-марок-в-таблицу-проверенных-км">1072 - получение результатов добавления марок в таблицу проверенных КМ</a></li>
                            </ul></li>
                            <li><a href="#программирование-ккт">Программирование ККТ</a><ul>
                            <li><a href="#настройка-клише">Настройка клише</a></li>
                            <li><a href="#загрузка-настроек-в-ккт">Загрузка настроек в ККТ</a></li>
                            <li><a href="#выгрузка-настроек-из-ккт">Выгрузка настроек из ККТ</a></li>
                            <li><a href="#логирование">Логирование</a></li>
                            </ul></li>
                            </ul>
                            
                        </div>
                    </div>
                </div>

                <div class="uk-width-medium-3-4">
<h2 id="настройка-драйвера">Настройка драйвера</h2>
<p>Настройка драйвера осуществляется через XML-файл, описывающий устройство по стандарту JPOS. Доступные следующие настройки:</p>
<ul>
<li>настройки связи с ККТ:
<ul>
<li><strong>channel</strong> - канал обмена с ККТ. Может принимать значения <strong>COM</strong>, <strong>USB</strong>, <strong>BLUETOOTH</strong>, <strong>TCP</strong>.</li>
<li><strong>com</strong> - название порта RS232 (для <strong>channel</strong> = <strong>COM</strong>). Для Windows принимает значения <em>COMN</em>, где <em>N</em> - номер порта (регистр символов не важен). Для Linux - <em>/dev/ttySN</em>, где <em>N</em> - номер порта (регистр символов важен).</li>
<li><strong>baudrate</strong> - скорость порта RS232, бод (для <strong>channel</strong> = <strong>COM</strong>). Может принимать значения <strong>1200</strong>, <strong>2400</strong>, <strong>4800</strong>, <strong>9600</strong>, <strong>19200</strong>, <strong>38400</strong>, <strong>57600</strong>, <strong>115200</strong>, <strong>230400</strong>, <strong>460800</strong>, <strong>912600</strong>.</li>
<li><strong>ip</strong> - IP-адрес и порт ККТ (для <strong>channel</strong> = <strong>TCP</strong>). Формат - <strong>host:port</strong>.</li>
<li><strong>mac</strong> - MAC-адрес ККТ (для <strong>channel</strong> = <strong>BLUETOOTH</strong>). Формат - <strong>XX:XX:XX:XX:XX:XX</strong>.</li>
<li><strong>usb</strong> - Путь к USB-устройству (для <strong>channel</strong> = <strong>USB</strong>). Только Linux. Например, <strong>2-1.2</strong> - путь из <em>/sys/bus/usb/devices/</em>. При использовании одной ККТ можно установить значение <strong>auto</strong>.</li>
</ul></li>
<li>настройки канала обмена с ОФД:
<ul>
<li><strong>ofdChannel</strong> - строка. Может принимать значения:
<ul>
<li><em>none</em> - драйвер не обменивается с ОФД;</li>
<li><em>auto</em> - драйвер автоматически включает обмен с ОФД в зависимости от значения настройки ККТ #276 (при использовании драйвера 10.6.3.0 и ниже всегда будет использоваться канал EthernetOverTransport);</li>
</ul></li>
</ul></li>
<li>настройки идентификаторов типов оплат. Значениями являются строки произвольной длины, которые будет использоваться в параметре <strong>description</strong> метода <strong>printRecTotal()</strong>:
<ul>
<li><strong>paymentCash</strong> - идентификатор оплаты наличными.</li>
<li><strong>paymentElectronically</strong> - идентификатор оплаты безналичными.</li>
<li><strong>paymentPrepaid</strong> - идентификатор оплаты предварительной оплатой (авансом).</li>
<li><strong>paymentCredit</strong> - идентификатор оплаты последующей оплатой (кредитом).</li>
<li><strong>paymentOther</strong> - идентификатор оплаты иной формой оплаты (встречным предоставлением).</li>
<li><strong>payment6</strong> - идентификатор оплаты, соответствующий расширенному типу оплаты №6 в ККТ.</li>
<li><strong>payment7</strong> - идентификатор оплаты, соответствующий расширенному типу оплаты №7 в ККТ.</li>
<li><strong>payment8</strong> - идентификатор оплаты, соответствующий расширенному типу оплаты №8 в ККТ.</li>
<li><strong>payment9</strong> - идентификатор оплаты, соответствующий расширенному типу оплаты №9 в ККТ.</li>
<li><strong>payment10</strong> - идентификатор оплаты, соответствующий расширенному типу оплаты №10 в ККТ.</li>
</ul></li>
<li>настройки типов оплат в ККТ:
<ul>
<li><strong>payment6Name</strong> - наименовение типа оплаты №6.</li>
<li><strong>payment7Name</strong> - наименовение типа оплаты №7.</li>
<li><strong>payment8Name</strong> - наименовение типа оплаты №8.</li>
<li><strong>payment9Name</strong> - наименовение типа оплаты №9.</li>
<li><strong>payment10Name</strong> - наименовение типа оплаты №10.</li>
<li><strong>payment6FiscalType</strong> - привязка типа оплаты №6 к способу расчета (2 - безналичными, 3 - аванс, 4 - кредит, 5 - встречное предоставление).</li>
<li><strong>payment7FiscalType</strong> - привязка типа оплаты №7 к способу расчета (2 - безналичными, 3 - аванс, 4 - кредит, 5 - встречное предоставление).</li>
<li><strong>payment8FiscalType</strong> - привязка типа оплаты №8 к способу расчета (2 - безналичными, 3 - аванс, 4 - кредит, 5 - встречное предоставление).</li>
<li><strong>payment9FiscalType</strong> - привязка типа оплаты №9 к способу расчета (2 - безналичными, 3 - аванс, 4 - кредит, 5 - встречное предоставление).</li>
<li><strong>payment10FiscalType</strong> - привязка типа оплаты №10 к способу расчета (2 - безналичными, 3 - аванс, 4 - кредит, 5 - встречное предоставление).</li>
</ul></li>
<li>настройки налоговых ставок. Значениями являются числа, которые будут использоваться в параметре <strong>vatInfo</strong> методов <strong>printRecItem()</strong> и <strong>printRecItemRefund()</strong>, а также в <strong>directIO #1026 (регистрация налога на чек)</strong>:
<ul>
<li><strong>vat0</strong> - идентификатор налоговой ставки “НДС 0%”.</li>
<li><strong>vatNo</strong> - идентификатор налоговой ставки “НДС не облагается”.</li>
<li><strong>vat10</strong> - идентификатор налоговой ставки “НДС 10%”.</li>
<li><strong>vat18</strong> - идентификатор налоговой ставки “НДС 20%” и “НДС 18%”.</li>
<li><strong>vat110</strong> - идентификатор налоговой ставки “НДС расчитанный 10/110”.</li>
<li><strong>vat118</strong> - идентификатор налоговой ставки “НДС расчитанный 20/120” и “НДС расчитанный 18/118”.</li>
</ul></li>
<li>настройки клише:
<ul>
<li><strong>numHeaderLines</strong> - количество строк заголовка чека (клише).</li>
<li><strong>numTrailerLines</strong> - количество строк подвала чека (реклама).</li>
<li><strong>picturesFileName</strong> - путь к файлу с описанием картинок для загрузки в ККТ. Если количество картинок в файле расходится с текущим количеством в ККТ, то картинки в ККТ удаляются и загружаются новые.</li>
<li><strong>clichePicturePrefix</strong> - подстрока, по которой драйвер будет определять строку клише с картинкой. Формат строки клише для печати картинки: <em>{PREFIX}N,M{PREFIX}</em>, где
<ul>
<li><em>{PREFIX}</em> - значение настройки <strong>clichePicturePrefix</strong>,</li>
<li><em>N</em> - номер картинки (картинки грузятся из файла <strong>picturesFileName</strong> по-порядку, нумеруются с 1)</li>
<li><em>M</em> - смещение при печати картинки, в пикселях</li>
</ul>
Например, <em>#$1,15#$</em> соответствует печати в строке клише картинки №1 со смещением 15 пикселей.</li>
</ul></li>
<li>настройки печати:
<ul>
<li><strong>printNonFiscalFooter</strong> - если значение равно 1, то при вызове <strong>endNonFiscalReceipt()</strong> печатается и подвал чека, и клише. Если 0 - только клише.</li>
<li><strong>defaultFont</strong> - шрифт нефискальных строк по умолчанию. Влияет на печать строк методами <strong>printRecMessage()</strong> и <strong>printNormal()</strong>, а также на любые строки, которые драйвер будет печатать самостоятельно. Не влияет на печать строк через <strong>directIO #1001 (печать строки с форматированием)</strong>.</li>
</ul></li>
<li>загрузка настроек в ККТ:
<ul>
<li><strong>parametersFileName</strong> - путь к файлу с настройками ККТ, которые будут переданы в ККТ при подключении. Подробное описание в разделе <strong>Настройка клише</strong>.</li>
</ul></li>
<li>выгрузка настроек из ККТ:
<ul>
<li><strong>exportDeviceParametersFile</strong> - путь к файлу, куда выполняется выгрузка. Подробное описание в разделе <strong>Выгрузка настроек из ККТ</strong>.</li>
<li><strong>exportDeviceParametersFilterFile</strong> - путь к файлу с фильтром выгружаемых настроек ККТ.</li>
</ul></li>
<li>различные кастомизации:
<ul>
<li><strong>grandTotalsWithShiftTotals</strong> - если 1, необнуляемый итог, получаемый с помощью запроса <strong>getData(FPTR_GD_GRAND_TOTAL)</strong>, возвращается с учетом сменного.</li>
<li><strong>grandTotalsInCents</strong> - если 1, то необнулямый, получаемый с помощью запроса <strong>getData(FPTR_GD_GRAND_TOTAL)</strong>, возвращается в копейках.</li>
<li><strong>checkSubtotal</strong> - если 1, то сумма итога, переданная в методе <strong>printRecSubtotal()</strong>, проверяется на соответствие той, которая была подсчитана драйвером. Если будет расхождение - драйвер вернет ошибку.</li>
<li><strong>unitNameAsAttribute</strong> - если 1, то интерпретировать параметр <strong>unitName</strong> метода <strong>printRecItem()</strong> как значение реквизита <strong>1197 (единицы измерения предмета расчета)</strong> для ФФД &lt; 1.2 или как значение реквизита <strong>2108 (мера количества предмета расчета)</strong> для ФФД 1.2.</li>
<li><strong>pieceUnitName</strong>- значение параметра <strong>unitName</strong> метода <strong>printRecItem()</strong>, по которому для позиции выставляется флаг штучного товара. При использовании этой настройки значение <strong>unitNameAsAttribute</strong> должно быть равно 0.</li>
<li><strong>receiptNumberType</strong> - если 1, то на запрос <strong>getData(FPTR_GD_RECEIPT_NUMBER)</strong> будет возвращаться номер последнего документа ФН. Если 0 - номер чека в смене из ФН.</li>
<li><strong>amountDecimalPlaces</strong> - кол-во знаков после запятой в суммах. При значении 2, для передачи суммы <em>12.34</em> нужно передавать <em>1234</em>, а при значении 4 - <em>123400</em>.</li>
<li><strong>cacheRecMessages</strong> - если 1, то все данные, поданные на печать методом <strong>printRecMessage()</strong> или <strong>directIO #1001 или #1002</strong> в состоянии <strong>FPTR_PS_FISCAL_RECEIPT_ENDING</strong>, будут напечатаны после закрытия чека, если 2, то такие строки будут напечатаны после слова “ИТОГ”, если 3, то строки будут напечатаны перед открытием чека.</li>
<li><strong>openShiftBeforeClose</strong> - если 1, то драйвер будет открывать смену перед её закрытием при вызове <strong>printZReport()</strong>.</li>
<li><strong>invertCashDrawerStatus</strong> - если 1, то драйвер будет инвертировать возвращаемое состояние денежного ящика.</li>
<li><strong>scriptsPath</strong> - путь к каталогу с пользовательскими скриптами ДТО10. Нужны, если в работе планируется использовать пользовательские реквизиты/скрипты ККТ. Подробнее про скрипты - в основной документации на ДТО10 - <a href="http://integration.atol.ru/api/#scripts" class="uri">http://integration.atol.ru/api/#scripts</a>.</li>
<li><strong>itemFormat</strong> - Формат передачи параметров позиции. 0 - price, quantity, sum = price * quantity + discount, отдельная команда скидки печатает нефискальную информацию о скидке; 1 - price, quantity, sum = price * quantity (скидка размазана по кол-ву), отдельная команда скидки печатает нефискальную информацию о скидке; 2 - price, quantity, sum = price * quantity (скидка не размазана по кол-ву), отдельная команда скидки применяет скидку к позиции; 3 - price, quantity, sum = price * quantity (скидка размазана по кол-ву), отдельная команда скидки не печатает ничего; 4 - price, quantity, sum = price * quantity (скидка размазана по кол-ву), отдельная команда скидки воспринимается как скидка на единицу и печатает нефискальную информацию о скидке.</li>
<li><strong>validateMarksWithFnmOnly</strong> - если 1, то проверку КМ выполняет драйвер, используя прямой доступ к ФН-М; если 0, то проверка КМ выполняется на стороне ККТ.</li>
<li><strong>enableBackgroundStatusUpdater</strong> - если 1, то разрешает вызов события StatusUpdateEvent при изменении состояния ККМ.</li>
</ul></li>
</ul>
<h2 id="поддержка-стандартных-операций">Поддержка стандартных операций</h2>
<h3 id="регистрация-кассира">Регистрация кассира</h3>
<p>С помощью метода <code>setPOSID()</code> можно задать номер ККТ в магазине и имя кассира.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb1-1" data-line-number="1">fptr.<span class="fu">setPOSID</span>(<span class="st">&quot;1&quot;</span> , <span class="st">&quot;Иванова А.А.&quot;</span>);</a></code></pre></div>
<p>Имя кассира также можно задать с помощью <strong>directIO #1038</strong>.</p>
<p>С помощью <strong>directIO #1027</strong> - ИНН кассира. Заданные таким образом параметры будут актуальны на время всей жизни экземпляра драйвера.</p>
<h3 id="печать-чека">Печать чека</h3>
<h4 id="открытие-чека">Открытие чека</h4>
<p>Для открытия чека необходимо установить его тип и вызвать метод открытия чека <code>beginFiscalReceipt()</code>. Поддерживаемые типы чека:</p>
<ul>
<li><code>FPTR_RT_SALES</code> - чек прихода</li>
<li><code>FPTR_RT_REFUND</code> - чек возврата прихода</li>
<li><code>100</code> - чек коррекции прихода (не входит в стандарт UPOS)</li>
<li><code>101</code> - чек коррекции возврата прихода (не входит в стандарт UPOS)</li>
<li><code>102</code> - чек расхода (не входит в стандарт UPOS)</li>
<li><code>103</code> - чек возврата расхода (не входит в стандарт UPOS)</li>
<li><code>104</code> - чек коррекции расхода (не входит в стандарт UPOS)</li>
<li><code>105</code> - чек коррекции возврата расхода (не входит в стандарт UPOS)</li>
</ul>
<p>Параметры метода <code>beginFiscalReceipt</code> игнорируются. Метод можно вызвать только из состояния <code>FPTR_PS_MONITOR</code>. Метод переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb2-1" data-line-number="1">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_SALES</span>);</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a></code></pre></div>
<p>Драйвер предоставляет возможность не печатать чек на чековой ленте. Для этого служит <strong>directIO #1009</strong>.</p>
<h4 id="регистрация-реквизита-чека">Регистрация реквизита чека</h4>
<p>В стандарте UPOS нет способа зарегистрировать реквизит чека. Потому драйвер предоставляет данный функционал через метод <code>directIO()</code>. Для этого используется <strong>directIO #1010</strong>.</p>
<h4 id="регистрация-позиции-чека-продажи-покупки">Регистрация позиции чека продажи / покупки</h4>
<p>Для регистрации позиции чека продажи / покупки используется следующий код:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb3-1" data-line-number="1">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;*1860 Напиток COCA-COLA газ.ПЭТ  2.0л&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;кг&quot;</span>);</a></code></pre></div>
<p>При этом будет зарегистрирована простейшая позиция с наименованием <em>“*1860 Напиток COCA-COLA газ.ПЭТ 2.0л”</em>, общей суммой <em>40.00</em>, количеством <em>2.000</em>, ценой за единицу <em>20.00</em>, ставкой налога <em>#1</em> и единицей измерения <em>кг</em>. Формат передачи цен подчиняется настройке <strong>amountDecimalPlaces</strong>. Способ обработки единицы измерения подчиняется настройке <strong>unitNameAsAttribute</strong>. Налоговые ставки регулируются настройками <strong>vat0</strong>, <strong>vatNo</strong>, <strong>vat10</strong>, <strong>vat110</strong>, <strong>vat18</strong>, <strong>vat118</strong>. Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<h4 id="регистрация-позиции-чека-возврата-продажи-покупки">Регистрация позиции чека возврата продажи / покупки</h4>
<p>Для регистрации позиции чека возврата продажи / покупки используется следующий код:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb4-1" data-line-number="1">fptr.<span class="fu">printRecItemRefund</span>(<span class="st">&quot;*1860 Напиток COCA-COLA газ.ПЭТ  2.0л&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;кг&quot;</span>);</a></code></pre></div>
<p>При этом будет зарегистрирована простейшая позиция с наименованием <em>“*1860 Напиток COCA-COLA газ.ПЭТ 2.0л”</em>, общей суммой <em>40.00</em>, количеством <em>2.000</em>, ценой за единицу <em>20.00</em>, ставкой налога <em>#1</em> и единицей измерения <em>кг</em>. Формат передачи цен подчиняется настройке <strong>amountDecimalPlaces</strong>. Способ обработки единицы измерения подчиняется настройке <strong>unitNameAsAttribute</strong>. Налоговая ставка регулируется настройками <strong>vat0</strong>, <strong>vatNo</strong>, <strong>vat10</strong>, <strong>vat110</strong>, <strong>vat18</strong>, <strong>vat118</strong>. Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<h4 id="скидка-на-позицию">Скидка на позицию</h4>
<p>Для регистрации скидки на позицию используется метод <code>printRecItemAdjustment()</code>. Сам метод на итоговую сумму чека не влияет, т.е. реальной скидки не делает, а только передает ее значение в ККТ для печати на чековой ленте. Драйвер обрабатывает только сумму скидки и её тип, остальные параметры игнорируются. Поддерживаются только суммовые скидки (тип <code>FPTR_AT_AMOUNT_DISCOUNT</code>). Формат передачи суммы подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb5-1" data-line-number="1">fptr.<span class="fu">printRecItemAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>, <span class="dv">1</span>);</a></code></pre></div>
<p>Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<h4 id="сумма-налога-на-позицию">Сумма налога на позицию</h4>
<p>Для регистрации суммы налога на позицию используется метод <strong>directIO #1033</strong>. Формат передачи суммы подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="bu">String</span> vatValue = <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">10000</span>);</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1033</span>, <span class="kw">null</span>, vatValue);</a></code></pre></div>
<p>Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<p>Сумму налога нужно передавать после регистрации позиции.</p>
<h4 id="регистрация-реквизита-позиции">Регистрация реквизита позиции</h4>
<p>В стандарте UPOS нет способа зарегистрировать реквизит позиции. Потому драйвер предоставляет данный функционал через метод <code>directIO()</code>. Для этого используется <strong>directIO #1011</strong>. Его нужно вызвать до регистрации самой позиции. Допускается регистрация нескольких реквизитов. Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<h4 id="печать-строки">Печать строки</h4>
<p>Для печати строки на чековой ленте внутри чека используется метод <code>printRecMessage()</code>. Поведение метода подчиняется настройкам <strong>cacheRecMessages</strong> и <strong>defaultFont</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb7-1" data-line-number="1">fptr.<span class="fu">printRecMessage</span>(<span class="st">&quot;Строка&quot;</span>);</a></code></pre></div>
<p>Также внутри чека будет работать метод <code>printNormal()</code>. Поддерживается только печать на чековой ленте (<code>FPTR_S_RECEIPT</code>). Поведение метода <strong>НЕ подчиняется</strong> настройке <strong>cacheRecMessages</strong>, но подчиняется <strong>defaultFont</strong>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb8-1" data-line-number="1">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;Строка&quot;</span>);</a></code></pre></div>
<p>Т.к. UPOS не позволяет менять форматирование текста, для этого можно использовать <strong>directIO #1001</strong>.</p>
<h4 id="печать-штрихкода">Печать штрихкода</h4>
<p>В стандарте UPOS нет способа напечатать штрихкод. Потому драйвер предоставляет данный функционал через метод <code>directIO()</code>. Для этого используется <strong>directIO #1002</strong>.</p>
<h4 id="регистрация-скидки-на-чек">Регистрация скидки на чек</h4>
<p>Драйвер позволяет зарегистрировать скидку-округления на чек. Для этого служит метод <code>printRecSubtotalAdjustment()</code>. Поддреживается только один тип скидки - <code>FPTR_AT_AMOUNT_DISCOUNT</code>. Формат передачи суммы подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb9-1" data-line-number="1">fptr.<span class="fu">printRecSubtotalAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>);</a></code></pre></div>
<p>Вызов данного метода не требуется для регистрации чеков коррекции по ФФД 1.05.</p>
<h4 id="регистрация-налога-на-чек">Регистрация налога на чек</h4>
<p>В стандарте UPOS нет способа зарегистрировать налог на чек. Потому драйвер предоставляет данный функционал через метод <code>directIO()</code>. Для этого используется <strong>directIO #1026</strong>. Метод доступен из состояний <code>FPTR_PS_FISCAL_RECEIPT</code> и <code>FPTR_PS_FISCAL_RECEIPT_TOTAL</code>.</p>
<h4 id="регистрация-оплаты">Регистрация оплаты</h4>
<p>Для регистрации оплаты используется метод <code>printRecTotal()</code>. Драйвер обрабатывает только сумму и тип оплаты, сумма итога не обрабатывается. Формат передачи суммы оплаты подчиняется настройке <strong>amountDecimalPlaces</strong>. Типы оплат регулируются настройками <strong>paymentCash</strong>, <strong>paymentElectronically</strong>, <strong>paymentPrepaid</strong>, <strong>paymentCredit</strong>, <strong>paymentOther</strong>, <strong>payment6</strong>, <strong>payment7</strong>, <strong>payment8</strong>, <strong>payment9</strong>, <strong>payment10</strong>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb10-1" data-line-number="1">fptr.<span class="fu">printRecTotal</span>(<span class="dv">7900</span>, <span class="dv">7900</span>, <span class="st">&quot;00&quot;</span>);</a></code></pre></div>
<p>Метод доступен из состояний <code>FPTR_PS_FISCAL_RECEIPT</code> и <code>FPTR_PS_FISCAL_RECEIPT_TOTAL</code>. Первая оплата переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT_TOTAL</code>. Как только чек полностью оплачивается, драйвер переводится в состояние <code>FPTR_PS_FISCAL_RECEIPT_ENDING</code>.</p>
<h4 id="отмена-чека">Отмена чека</h4>
<p>Для отмены чека необходимо вызвать метод <code>printRecVoid()</code>, а после него закрыть чек. Параметры метода игнорируются.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb11-1" data-line-number="1">fptr.<span class="fu">printRecVoid</span>(<span class="st">&quot;&quot;</span>);</a></code></pre></div>
<p>Метод переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT_ENDING</code>.</p>
<h4 id="закрытие-чека">Закрытие чека</h4>
<p>Для закрытия чека необходимо вызвать метод <code>endFiscalReceipt()</code>. Параметры метода игнорируются.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb12-1" data-line-number="1">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<p>Метод доступен из состояний <code>FPTR_PS_FISCAL_RECEIPT</code> и <code>FPTR_PS_FISCAL_RECEIPT_ENDING</code>. Метод переводит драйвер в состояние <code>FPTR_PS_MONITOR</code>.</p>
<h4 id="пример-формирования-чека-прихода">Пример формирования чека прихода</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_SALES</span>);</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">// Дополнительные реквизиты чека - СНО, телефон получателя электронного чека</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">5</span>, <span class="dv">0</span>}, <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="bn">0x01</span>) <span class="co">/*ОСН*/</span>);</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>, <span class="dv">1</span>}, <span class="st">&quot;client@mail.ru&quot;</span>);</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">// Регистрация позиции с дополнительными реквизитами и скидкой</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">3</span>, <span class="dv">0</span>}, <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">2</span>)); <span class="co">// Признак предмета расчета</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Товар 1&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;шт&quot;</span>);</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">fptr.<span class="fu">printRecItemAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>, <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb13-13" data-line-number="13"></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">// Нефискальный текст - разделитель позиций</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">fptr.<span class="fu">printRecMessage</span>(<span class="st">&quot;----------------------------------------------------------------&quot;</span>);</a>
<a class="sourceLine" id="cb13-16" data-line-number="16"></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">// Регистрация простейшей позиции</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Товар 2&quot;</span>, <span class="dv">3990</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">3990</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb13-19" data-line-number="19"></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">// Скидка-округление на чек</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21">fptr.<span class="fu">printRecSubtotalAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>);</a>
<a class="sourceLine" id="cb13-22" data-line-number="22"></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24">fptr.<span class="fu">printRecTotal</span>(<span class="dv">7900</span>, <span class="dv">7900</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb13-25" data-line-number="25"></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-прихода-ффд-1.2">Пример формирования чека прихода (ФФД 1.2)</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_SALES</span>); <span class="co">// Тип чека, чек прихода</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">// Добавление КМ для проверки</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="dt">int</span> markingType = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="dt">byte</span>[] markingCode = {<span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x34</span>, <span class="bn">0x34</span>, <span class="bn">0x39</span>, <span class="bn">0x34</span>, <span class="bn">0x35</span>, <span class="bn">0x35</span>, <span class="bn">0x30</span>, <span class="bn">0x34</span>, <span class="bn">0x33</span>, <span class="bn">0x35</span>, <span class="bn">0x33</span>, <span class="bn">0x30</span>, <span class="bn">0x36</span>, <span class="bn">0x38</span>, <span class="bn">0x32</span>, <span class="bn">0x31</span>, </a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="bn">0x51</span>, <span class="bn">0x58</span>, <span class="bn">0x59</span>, <span class="bn">0x58</span>, <span class="bn">0x53</span>, <span class="bn">0x41</span>, <span class="bn">0x4C</span>, <span class="bn">0x47</span>, <span class="bn">0x4C</span>, <span class="bn">0x4D</span>, <span class="bn">0x59</span>, <span class="bn">0x51</span>, <span class="bn">0x51</span>, <span class="bn">0x1D</span>, <span class="bn">0x39</span>, <span class="bn">0x31</span>, <span class="bn">0x45</span>, <span class="bn">0x45</span>, <span class="bn">0x30</span>, <span class="bn">0x36</span>, <span class="bn">0x1D</span>, <span class="bn">0x39</span>, </a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="bn">0x32</span>, <span class="bn">0x59</span>, <span class="bn">0x57</span>, <span class="bn">0x43</span>, <span class="bn">0x58</span>, <span class="bn">0x62</span>, <span class="bn">0x6D</span>, <span class="bn">0x4B</span>, <span class="bn">0x36</span>, <span class="bn">0x53</span>, <span class="bn">0x4E</span>, <span class="bn">0x38</span>, <span class="bn">0x76</span>, <span class="bn">0x76</span>, <span class="bn">0x77</span>, <span class="bn">0x6F</span>, <span class="bn">0x78</span>, <span class="bn">0x5A</span>, <span class="bn">0x46</span>, <span class="bn">0x6B</span>, <span class="bn">0x37</span>, <span class="bn">0x57</span>, </a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="bn">0x41</span>, <span class="bn">0x59</span>, <span class="bn">0x38</span>, <span class="bn">0x57</span>, <span class="bn">0x6F</span>, <span class="bn">0x4A</span>, <span class="bn">0x4E</span>, <span class="bn">0x4D</span>, <span class="bn">0x47</span>, <span class="bn">0x47</span>, <span class="bn">0x72</span>, <span class="bn">0x36</span>, <span class="bn">0x43</span>, <span class="bn">0x67</span>, <span class="bn">0x74</span>, <span class="bn">0x69</span>, <span class="bn">0x75</span>, <span class="bn">0x6A</span>, <span class="bn">0x61</span>, <span class="bn">0x30</span>, <span class="bn">0x34</span>, <span class="bn">0x63</span>, <span class="bn">0x3D</span>};</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="dt">int</span> markingStatus = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="dt">int</span> processingMode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="dt">int</span> waitForResult = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">fptr.<span class="fu">directIO</span>(<span class="dv">1051</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, <span class="kw">null</span>, markingType, markingStatus, processingMode, <span class="kw">null</span>, <span class="kw">null</span>, waitForResult});</a>
<a class="sourceLine" id="cb14-15" data-line-number="15"></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">// Запуск проверки КМ</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="dt">int</span>[] timeout = {<span class="dv">90000</span>};</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">fptr.<span class="fu">directIO</span>(<span class="dv">1052</span>, timeout, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">// Получение результата проверки КМ</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="dt">int</span>[] iArg = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">10</span>];</a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="bu">String</span>[] sArg = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb14-23" data-line-number="23">iArg[<span class="dv">0</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb14-24" data-line-number="24">fptr.<span class="fu">directIO</span>(<span class="dv">1053</span>, iArg, sArg);</a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="dt">int</span> onlineValidationResult = iArg[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="dt">int</span> statusInfo = iArg[<span class="dv">7</span>];</a>
<a class="sourceLine" id="cb14-27" data-line-number="27"></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="co">// Дополнительные реквизиты чека - СНО, телефон получателя электронного чека</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">5</span>, <span class="dv">0</span>}, <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="bn">0x01</span>)); <span class="co">// Система налогообложения, тег 1055</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>, <span class="dv">1</span>}, <span class="st">&quot;client@mail.ru&quot;</span>); <span class="co">// Телефон/Email покупателя, тег 1008</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"></a>
<a class="sourceLine" id="cb14-32" data-line-number="32"><span class="co">// передача дополнительного операционного реквизита чека, тег 1270</span></a>
<a class="sourceLine" id="cb14-33" data-line-number="33"><span class="dt">int</span> operationId = <span class="dv">7</span>; <span class="co">// Идентификатор операции, тег 1271</span></a>
<a class="sourceLine" id="cb14-34" data-line-number="34"><span class="bu">String</span> operationData = <span class="st">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>; <span class="co">// Данные операци, тег 1272</span></a>
<a class="sourceLine" id="cb14-35" data-line-number="35"><span class="bu">String</span> operationDate = <span class="st">&quot;31122020173621&quot;</span>; <span class="co">// Дата, время операции, тег 1273, 31.12.2020 17:36:21</span></a>
<a class="sourceLine" id="cb14-36" data-line-number="36">fptr.<span class="fu">directIO</span>(<span class="dv">1057</span>, <span class="kw">new</span> <span class="dt">int</span>[]{operationId}, <span class="kw">new</span> <span class="bu">String</span>[]{operationData, operationDate});</a>
<a class="sourceLine" id="cb14-37" data-line-number="37"></a>
<a class="sourceLine" id="cb14-38" data-line-number="38"><span class="co">// 1056 - передача отраслевого реквизита чека, тег 1261</span></a>
<a class="sourceLine" id="cb14-39" data-line-number="39"><span class="bu">String</span> foiv = <span class="st">&quot;010&quot;</span>; <span class="co">// Тег 1262</span></a>
<a class="sourceLine" id="cb14-40" data-line-number="40"><span class="bu">String</span> date = <span class="st">&quot;31122018&quot;</span>; <span class="co">// Тег 1263, “ddMMyyyy”</span></a>
<a class="sourceLine" id="cb14-41" data-line-number="41"><span class="bu">String</span> num = <span class="st">&quot;12345678901234567890&quot;</span>; <span class="co">//  Тег 1264</span></a>
<a class="sourceLine" id="cb14-42" data-line-number="42"><span class="bu">String</span> industryAttr = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>; <span class="co">// Тег 1265</span></a>
<a class="sourceLine" id="cb14-43" data-line-number="43">fptr.<span class="fu">directIO</span>(<span class="dv">1056</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv, date, num, industryAttr});</a>
<a class="sourceLine" id="cb14-44" data-line-number="44"></a>
<a class="sourceLine" id="cb14-45" data-line-number="45"><span class="co">// запись неразобранной марки в позицию чека</span></a>
<a class="sourceLine" id="cb14-46" data-line-number="46">fptr.<span class="fu">directIO</span>(<span class="dv">1049</span>, <span class="kw">new</span> <span class="dt">int</span>[]{markingType, statusInfo, processingMode, onlineValidationResult}, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, <span class="kw">null</span>});</a>
<a class="sourceLine" id="cb14-47" data-line-number="47"></a>
<a class="sourceLine" id="cb14-48" data-line-number="48"><span class="co">// передача отраслевого реквизита предмета расчёта, тег 1260</span></a>
<a class="sourceLine" id="cb14-49" data-line-number="49"><span class="bu">String</span> foiv1 = <span class="st">&quot;010&quot;</span>; <span class="co">// Тег 1262</span></a>
<a class="sourceLine" id="cb14-50" data-line-number="50"><span class="bu">String</span> date1 = <span class="st">&quot;31122018&quot;</span>; <span class="co">// Тег 1263</span></a>
<a class="sourceLine" id="cb14-51" data-line-number="51"><span class="bu">String</span> num1 = <span class="st">&quot;12345678901234567890&quot;</span>; <span class="co">// Тег 1264</span></a>
<a class="sourceLine" id="cb14-52" data-line-number="52"><span class="bu">String</span> industryAttr1 = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>; <span class="co">// Тег 1265</span></a>
<a class="sourceLine" id="cb14-53" data-line-number="53">fptr.<span class="fu">directIO</span>(<span class="dv">1055</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv1, date1, num1, industryAttr1});</a>
<a class="sourceLine" id="cb14-54" data-line-number="54"></a>
<a class="sourceLine" id="cb14-55" data-line-number="55"><span class="co">// Регистрация позиции с КМ</span></a>
<a class="sourceLine" id="cb14-56" data-line-number="56">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Табак&quot;</span>, <span class="dv">4000</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">4000</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb14-57" data-line-number="57"></a>
<a class="sourceLine" id="cb14-58" data-line-number="58"><span class="co">// Регистрация позиции без КМ</span></a>
<a class="sourceLine" id="cb14-59" data-line-number="59">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">2</span>, <span class="dv">1</span>}, <span class="st">&quot;11&quot;</span>); <span class="co">// Мера количества предмета расчета, тег 2108</span></a>
<a class="sourceLine" id="cb14-60" data-line-number="60">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">3</span>, <span class="dv">0</span>}, <span class="st">&quot;1&quot;</span>); <span class="co">// Признак предмета расчета, тег 1212</span></a>
<a class="sourceLine" id="cb14-61" data-line-number="61">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">4</span>, <span class="dv">0</span>}, <span class="st">&quot;4&quot;</span>); <span class="co">// Признак способа расчета, тег 1214</span></a>
<a class="sourceLine" id="cb14-62" data-line-number="62">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Помидор&quot;</span>, <span class="dv">6000</span>, <span class="dv">1000</span>, <span class="dv">2</span>, <span class="dv">6000</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb14-63" data-line-number="63"></a>
<a class="sourceLine" id="cb14-64" data-line-number="64"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb14-65" data-line-number="65">fptr.<span class="fu">printRecTotal</span>(<span class="dv">10000</span>, <span class="dv">10000</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb14-66" data-line-number="66"></a>
<a class="sourceLine" id="cb14-67" data-line-number="67"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb14-68" data-line-number="68">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-прихода-без-печати-на-чековой-ленте">Пример формирования чека прихода без печати на чековой ленте</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_SALES</span>);</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1009</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">// Дополнительные реквизиты чека - СНО, телефон получателя электронного чека</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">5</span>, <span class="dv">0</span>}, <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="bn">0x01</span>) <span class="co">/*ОСН*/</span>);</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>, <span class="dv">1</span>}, <span class="st">&quot;client@mail.ru&quot;</span>);</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">// Регистрация позиции с дополнительными реквизитами и скидкой</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Товар 1&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;шт&quot;</span>);</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">fptr.<span class="fu">printRecItemAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>, <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">// Нефискальный текст - разделитель позиций</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15">fptr.<span class="fu">printRecMessage</span>(<span class="st">&quot;----------------------------------------------------------------&quot;</span>);</a>
<a class="sourceLine" id="cb15-16" data-line-number="16"></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">// Регистрация простейшей позиции</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Товар 2&quot;</span>, <span class="dv">3990</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">3990</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb15-19" data-line-number="19"></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">// Скидка-округление на чек</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21">fptr.<span class="fu">printRecSubtotalAdjustment</span>(FiscalPrinterConst.<span class="fu">FPTR_AT_AMOUNT_DISCOUNT</span>, <span class="st">&quot;&quot;</span>, <span class="dv">90</span>);</a>
<a class="sourceLine" id="cb15-22" data-line-number="22"></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24">fptr.<span class="fu">printRecTotal</span>(<span class="dv">7900</span>, <span class="dv">7900</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb15-25" data-line-number="25"></a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-прихода-с-табачным-товаром">Пример формирования чека прихода с табачным товаром</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_SALES</span>);</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">// Регистрация табачной позиции</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">fptr.<span class="fu">directIO</span>(<span class="dv">1029</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{<span class="st">&quot;98765432101234&quot;</span>, <span class="st">&quot;ABC1234&quot;</span>});</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">fptr.<span class="fu">printRecItem</span>(<span class="st">&quot;Табак&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;шт&quot;</span>);</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10">fptr.<span class="fu">printRecTotal</span>(<span class="dv">4000</span>, <span class="dv">4000</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-возврата">Пример формирования чека возврата</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_REFUND</span>);</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">// Регистрация позиции</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">fptr.<span class="fu">printRecItemRefund</span>(<span class="st">&quot;Табак&quot;</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">1</span>, <span class="dv">2000</span>, <span class="st">&quot;шт&quot;</span>);</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">fptr.<span class="fu">printRecTotal</span>(<span class="dv">4000</span>, <span class="dv">4000</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-коррекции-ффд-1.05">Пример формирования чека коррекции (ФФД 1.05)</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(<span class="dv">100</span>);</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">// Основание для коррекции</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">20</span>, <span class="dv">0</span>}, <span class="st">&quot;0&quot;</span>);</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">22</span>, <span class="dv">4</span>}, <span class="st">&quot;01012018000000&quot;</span>);</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">23</span>, <span class="dv">1</span>}, <span class="st">&quot;№ 1234&quot;</span>);</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">24</span>, <span class="dv">1</span>}, <span class="st">&quot;3463429169&quot;</span>);</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">// Налоги</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">fptr.<span class="fu">directIO</span>(<span class="dv">1026</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>}, <span class="st">&quot;1000&quot;</span>);</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">fptr.<span class="fu">directIO</span>(<span class="dv">1026</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">2</span>}, <span class="st">&quot;1300&quot;</span>);</a>
<a class="sourceLine" id="cb18-14" data-line-number="14"></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">// Оплаты</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16">fptr.<span class="fu">printRecTotal</span>(<span class="dv">100000</span>, <span class="dv">20000</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb18-17" data-line-number="17">fptr.<span class="fu">printRecTotal</span>(<span class="dv">100000</span>, <span class="dv">80000</span>, <span class="st">&quot;10&quot;</span>);</a>
<a class="sourceLine" id="cb18-18" data-line-number="18"></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h4 id="пример-формирования-чека-коррекции-возврата-расхода-ффд-1.2">Пример формирования чека коррекции возврата расхода (ФФД 1.2)</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">// Открытие чека</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(<span class="dv">105</span>); <span class="co">// Тип чека, чек коррекции возврата расхода</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">// Основание для коррекции</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">20</span>, <span class="dv">0</span>}, <span class="st">&quot;0&quot;</span>); <span class="co">// Тип коррекции, тег 1173</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">23</span>, <span class="dv">1</span>}, <span class="st">&quot;№ 1234&quot;</span>); <span class="co">// Номер документа основания, тег 1179</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">22</span>, <span class="dv">4</span>}, <span class="st">&quot;01012018000000&quot;</span>); <span class="co">// Дата документа основания, тег 1178</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">24</span>, <span class="dv">1</span>}, <span class="st">&quot;3463429169&quot;</span>);</a>
<a class="sourceLine" id="cb19-10" data-line-number="10"></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">// Добавление КМ для проверки</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="dt">int</span> markingType = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="dt">byte</span>[] markingCode = {<span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x34</span>, <span class="bn">0x34</span>, <span class="bn">0x39</span>, <span class="bn">0x34</span>, <span class="bn">0x35</span>, <span class="bn">0x35</span>, <span class="bn">0x30</span>, <span class="bn">0x34</span>, <span class="bn">0x33</span>, <span class="bn">0x35</span>, <span class="bn">0x33</span>, <span class="bn">0x30</span>, <span class="bn">0x36</span>, <span class="bn">0x38</span>, </a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="bn">0x32</span>, <span class="bn">0x31</span>, <span class="bn">0x51</span>, <span class="bn">0x58</span>, <span class="bn">0x59</span>, <span class="bn">0x58</span>, <span class="bn">0x53</span>, <span class="bn">0x41</span>, <span class="bn">0x4C</span>, <span class="bn">0x47</span>, <span class="bn">0x4C</span>, <span class="bn">0x4D</span>, <span class="bn">0x59</span>, <span class="bn">0x51</span>, <span class="bn">0x51</span>, <span class="bn">0x1D</span>, <span class="bn">0x39</span>, <span class="bn">0x31</span>, <span class="bn">0x45</span>, <span class="bn">0x45</span>, </a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="bn">0x30</span>, <span class="bn">0x36</span>, <span class="bn">0x1D</span>, <span class="bn">0x39</span>, <span class="bn">0x32</span>, <span class="bn">0x59</span>, <span class="bn">0x57</span>, <span class="bn">0x43</span>, <span class="bn">0x58</span>, <span class="bn">0x62</span>, <span class="bn">0x6D</span>, <span class="bn">0x4B</span>, <span class="bn">0x36</span>, <span class="bn">0x53</span>, <span class="bn">0x4E</span>, <span class="bn">0x38</span>, <span class="bn">0x76</span>, <span class="bn">0x76</span>, <span class="bn">0x77</span>, <span class="bn">0x6F</span>, </a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="bn">0x78</span>, <span class="bn">0x5A</span>, <span class="bn">0x46</span>, <span class="bn">0x6B</span>, <span class="bn">0x37</span>, <span class="bn">0x57</span>, <span class="bn">0x41</span>, <span class="bn">0x59</span>, <span class="bn">0x38</span>, <span class="bn">0x57</span>, <span class="bn">0x6F</span>, <span class="bn">0x4A</span>, <span class="bn">0x4E</span>, <span class="bn">0x4D</span>, <span class="bn">0x47</span>, <span class="bn">0x47</span>, <span class="bn">0x72</span>, <span class="bn">0x36</span>, <span class="bn">0x43</span>, <span class="bn">0x67</span>, </a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="bn">0x74</span>, <span class="bn">0x69</span>, <span class="bn">0x75</span>, <span class="bn">0x6A</span>, <span class="bn">0x61</span>, <span class="bn">0x30</span>, <span class="bn">0x34</span>, <span class="bn">0x63</span>, <span class="bn">0x3D</span>};</a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="dt">int</span> markingStatus = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="dt">int</span> processingMode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="dt">int</span> waitForResult = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">fptr.<span class="fu">directIO</span>(<span class="dv">1051</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, <span class="kw">null</span>, markingType, markingStatus, processingMode, <span class="kw">null</span>, <span class="kw">null</span>, waitForResult});</a>
<a class="sourceLine" id="cb19-22" data-line-number="22"></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="co">// Запуск проверки КМ</span></a>
<a class="sourceLine" id="cb19-24" data-line-number="24"><span class="dt">int</span>[] timeout = {<span class="dv">90000</span>};</a>
<a class="sourceLine" id="cb19-25" data-line-number="25">fptr.<span class="fu">directIO</span>(<span class="dv">1052</span>, timeout, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb19-26" data-line-number="26"></a>
<a class="sourceLine" id="cb19-27" data-line-number="27"><span class="co">// Получение результата проверки КМ</span></a>
<a class="sourceLine" id="cb19-28" data-line-number="28"><span class="dt">int</span>[] iArg = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">10</span>];</a>
<a class="sourceLine" id="cb19-29" data-line-number="29"><span class="bu">String</span>[] sArg = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb19-30" data-line-number="30">iArg[<span class="dv">0</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">fptr.<span class="fu">directIO</span>(<span class="dv">1053</span>, iArg, sArg);</a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="dt">int</span> onlineValidationResult = iArg[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb19-33" data-line-number="33"><span class="dt">int</span> statusInfo = iArg[<span class="dv">7</span>];</a>
<a class="sourceLine" id="cb19-34" data-line-number="34"></a>
<a class="sourceLine" id="cb19-35" data-line-number="35"><span class="co">// Дополнительные реквизиты чека - СНО, телефон получателя электронного чека</span></a>
<a class="sourceLine" id="cb19-36" data-line-number="36">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">5</span>, <span class="dv">0</span>}, <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="bn">0x01</span>)); <span class="co">// Система налогообложения, тег 1055</span></a>
<a class="sourceLine" id="cb19-37" data-line-number="37">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>, <span class="dv">1</span>}, <span class="st">&quot;client@mail.ru&quot;</span>); <span class="co">// Телефон/Email покупателя, тег 1008</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"></a>
<a class="sourceLine" id="cb19-39" data-line-number="39"><span class="co">// передача дополнительного операционного реквизита чека, тег 1270</span></a>
<a class="sourceLine" id="cb19-40" data-line-number="40"><span class="dt">int</span> operationId = <span class="dv">7</span>; <span class="co">// идентификатор операции, тег 1271</span></a>
<a class="sourceLine" id="cb19-41" data-line-number="41"><span class="bu">String</span> operationData = <span class="st">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>; <span class="co">// Данные операци, тег 1272</span></a>
<a class="sourceLine" id="cb19-42" data-line-number="42"><span class="bu">String</span> operationDate = <span class="st">&quot;31122020173621&quot;</span>; <span class="co">// Дата, время операции, тег 1273, 31.12.2020 17:36:21</span></a>
<a class="sourceLine" id="cb19-43" data-line-number="43">fptr.<span class="fu">directIO</span>(<span class="dv">1057</span>, <span class="kw">new</span> <span class="dt">int</span>[]{operationId}, <span class="kw">new</span> <span class="bu">String</span>[]{operationData, operationDate});</a>
<a class="sourceLine" id="cb19-44" data-line-number="44"></a>
<a class="sourceLine" id="cb19-45" data-line-number="45"><span class="co">// 1056 - передача отраслевого реквизита чека, тег 1261</span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46"><span class="bu">String</span> foiv = <span class="st">&quot;010&quot;</span>; <span class="co">// Тег 1262</span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47"><span class="bu">String</span> date = <span class="st">&quot;31122018&quot;</span>; <span class="co">// тег 1263, “ddMMyyyy”</span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48"><span class="bu">String</span> num = <span class="st">&quot;12345678901234567890&quot;</span>; <span class="co">//  Тег 1264</span></a>
<a class="sourceLine" id="cb19-49" data-line-number="49"><span class="bu">String</span> industryAttr = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>; <span class="co">// Тег 1265</span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50">fptr.<span class="fu">directIO</span>(<span class="dv">1056</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv, date, num, industryAttr});</a>
<a class="sourceLine" id="cb19-51" data-line-number="51"></a>
<a class="sourceLine" id="cb19-52" data-line-number="52"><span class="co">// запись неразобранной марки в позицию чека</span></a>
<a class="sourceLine" id="cb19-53" data-line-number="53">fptr.<span class="fu">directIO</span>(<span class="dv">1049</span>, <span class="kw">new</span> <span class="dt">int</span>[]{markingType, statusInfo, processingMode, onlineValidationResult}, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, <span class="kw">null</span>});</a>
<a class="sourceLine" id="cb19-54" data-line-number="54"></a>
<a class="sourceLine" id="cb19-55" data-line-number="55"><span class="co">// передача отраслевого реквизита предмета расчёта, тег 1260</span></a>
<a class="sourceLine" id="cb19-56" data-line-number="56"><span class="bu">String</span> foiv1 = <span class="st">&quot;010&quot;</span>; <span class="co">// Тег 1262</span></a>
<a class="sourceLine" id="cb19-57" data-line-number="57"><span class="bu">String</span> date1 = <span class="st">&quot;31122018&quot;</span>; <span class="co">// Тег 1263</span></a>
<a class="sourceLine" id="cb19-58" data-line-number="58"><span class="bu">String</span> num1 = <span class="st">&quot;12345678901234567890&quot;</span>; <span class="co">// Тег 1264</span></a>
<a class="sourceLine" id="cb19-59" data-line-number="59"><span class="bu">String</span> industryAttr1 = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>; <span class="co">// Тег 1265</span></a>
<a class="sourceLine" id="cb19-60" data-line-number="60">fptr.<span class="fu">directIO</span>(<span class="dv">1055</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv1, date1, num1, industryAttr1});</a>
<a class="sourceLine" id="cb19-61" data-line-number="61"></a>
<a class="sourceLine" id="cb19-62" data-line-number="62"><span class="co">// Регистрация позиции с КМ</span></a>
<a class="sourceLine" id="cb19-63" data-line-number="63">fptr.<span class="fu">printRecItemRefund</span>(<span class="st">&quot;Табак&quot;</span>, <span class="dv">4000</span>, <span class="dv">1000</span>, <span class="dv">1</span>, <span class="dv">4000</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb19-64" data-line-number="64"></a>
<a class="sourceLine" id="cb19-65" data-line-number="65"><span class="co">// Регистрация позиции без КМ</span></a>
<a class="sourceLine" id="cb19-66" data-line-number="66">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">2</span>, <span class="dv">1</span>}, <span class="st">&quot;11&quot;</span>); <span class="co">// Мера количества предмета расчета, тег 2108</span></a>
<a class="sourceLine" id="cb19-67" data-line-number="67">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">3</span>, <span class="dv">0</span>}, <span class="st">&quot;1&quot;</span>); <span class="co">// Признак предмета расчета, тег 1212</span></a>
<a class="sourceLine" id="cb19-68" data-line-number="68">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">4</span>, <span class="dv">0</span>}, <span class="st">&quot;4&quot;</span>); <span class="co">// Признак способа расчета, тег 1214</span></a>
<a class="sourceLine" id="cb19-69" data-line-number="69">fptr.<span class="fu">printRecItemRefund</span>(<span class="st">&quot;Помидор&quot;</span>, <span class="dv">6000</span>, <span class="dv">1000</span>, <span class="dv">2</span>, <span class="dv">6000</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb19-70" data-line-number="70"></a>
<a class="sourceLine" id="cb19-71" data-line-number="71"><span class="co">// Оплата</span></a>
<a class="sourceLine" id="cb19-72" data-line-number="72">fptr.<span class="fu">printRecTotal</span>(<span class="dv">10000</span>, <span class="dv">10000</span>, <span class="st">&quot;00&quot;</span>);</a>
<a class="sourceLine" id="cb19-73" data-line-number="73"></a>
<a class="sourceLine" id="cb19-74" data-line-number="74"><span class="co">// Закрытие чека</span></a>
<a class="sourceLine" id="cb19-75" data-line-number="75">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h3 id="закрытие-смены">Закрытие смены</h3>
<p>Для закрытия смены используется метод <code>printZReport()</code>. Автоматическое открытие смены регулируется настройкой <strong>openShiftBeforeClose</strong>.</p>
<h3 id="печать-x-отчета">Печать X-отчета</h3>
<p>Для печати X-отчета используется метод <code>printXReport()</code>.</p>
<h3 id="печать-отчета-о-состоянии-расчетов">Печать отчета о состоянии расчетов</h3>
<p>Для печати отчета о состоянии расчетов <code>printReport()</code>, указав тип отчета равный 100. Остальные параметры метода игнорируются.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb20-1" data-line-number="1">fptr.<span class="fu">printReport</span>(<span class="dv">100</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>);</a></code></pre></div>
<h3 id="внесения-выплаты">Внесения / выплаты</h3>
<h4 id="открытие-документа-внесения-выплаты">Открытие документа внесения / выплаты</h4>
<p>Для открытия документа внесения / выплаты необходимо установить его тип и вызвать метод <code>beginFiscalReceipt()</code>. Поддерживаемые типы чека:</p>
<ul>
<li><code>FPTR_RT_CASH_IN</code> - внесение</li>
<li><code>FPTR_RT_CASH_OUT</code> - выплата</li>
</ul>
<p>Параметры метода <code>beginFiscalReceipt</code> игнорируются.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb21-1" data-line-number="1">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_CASH_IN</span>);</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a></code></pre></div>
<p>Метод можно вызвать только из состояния <code>FPTR_PS_MONITOR</code>. Метод переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT</code>.</p>
<h4 id="регистрация-внесения-выплаты">Регистрация внесения / выплаты</h4>
<p>Для регистрации внесения / выплаты используется метод <code>printRecCash()</code>. Все суммы складываются и передаются в ККТ. Формат передачи суммы подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb22-1" data-line-number="1">fptr.<span class="fu">printRecCash</span>(<span class="dv">10000</span>);</a></code></pre></div>
<h4 id="отмена-документа-внесения-выплаты">Отмена документа внесения / выплаты</h4>
<p>Для отмены документа внесения / выплаты необходимо вызвать метод <code>printRecVoid()</code>, а после него закрыть документ. Параметры метода игнорируются.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb23-1" data-line-number="1">fptr.<span class="fu">printRecVoid</span>(<span class="st">&quot;&quot;</span>);</a></code></pre></div>
<p>Метод переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT_ENDING</code>.</p>
<h4 id="закрытие-документа-внесения-выплаты">Закрытие документа внесения / выплаты</h4>
<p>Для закрытия документа внесения / выплаты необходимо вызвать метод <code>endFiscalReceipt()</code>. Параметры метода игнорируются.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb24-1" data-line-number="1">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<p>Метод доступен из состояний <code>FPTR_PS_FISCAL_RECEIPT</code> и <code>FPTR_PS_FISCAL_RECEIPT_ENDING</code>. Метод переводит драйвер в состояние <code>FPTR_PS_MONITOR</code>.</p>
<h4 id="пример-формирования-внесения">Пример формирования внесения</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co">// Открытие внесения</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">fptr.<span class="fu">setFiscalReceiptType</span>(FiscalPrinterConst.<span class="fu">FPTR_RT_CASH_IN</span>);</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">fptr.<span class="fu">beginFiscalReceipt</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">// Внесение сумм</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">fptr.<span class="fu">printRecCash</span>(<span class="dv">10000</span>);</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">fptr.<span class="fu">printRecCash</span>(<span class="dv">20000</span>);</a>
<a class="sourceLine" id="cb25-8" data-line-number="8"></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">// Закрытие внесения</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10">fptr.<span class="fu">endFiscalReceipt</span>(<span class="kw">false</span>);</a></code></pre></div>
<h3 id="нефискальные-документы">Нефискальные документы</h3>
<h4 id="открытие-нефискального-документа">Открытие нефискального документа</h4>
<p>Для открытия нефискального документа используется метод <code>beginNonFiscal()</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb26-1" data-line-number="1">fptr.<span class="fu">beginNonFiscal</span>();</a></code></pre></div>
<p>Метод можно вызвать только из состояния <code>FPTR_PS_MONITOR</code>. Метод переводит драйвер в состояние <code>FPTR_PS_FISCAL_RECEIPT</code>.</p>
<h4 id="закрытие-нефискального-документа">Закрытие нефискального документа</h4>
<p>Для закрытия нефискального документа используется метод <code>endNonFiscal()</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb27-1" data-line-number="1">fptr.<span class="fu">endNonFiscal</span>();</a></code></pre></div>
<p>Метод переводит драйвер в состояние <code>FPTR_PS_MONITOR</code>.</p>
<h4 id="печать-строки-1">Печать строки</h4>
<p>Для печати строки на чековой ленте внутри нефискального документа используется метод <code>printNormal()</code>. Поведение метода подчиняется настройке <strong>defaultFont</strong>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb28-1" data-line-number="1">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;Строка&quot;</span>);</a></code></pre></div>
<p>Т.к. UPOS не позволяет менять форматирование текста, для этого можно использовать <strong>directIO #1001</strong>.</p>
<h4 id="печать-штрихкода-1">Печать штрихкода</h4>
<p>В стандарте UPOS нет способа напечатать штрихкод. Потому драйвер предоставляет данный функционал через метод <code>directIO()</code>. Для этого используется <strong>directIO #1002</strong>.</p>
<h4 id="пример-печати-нефискального-документа-на-примере-слипа-егаис">Пример печати нефискального документа (на примере слипа ЕГАИС)</h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co">// Открытие нефискального документа</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">fptr.<span class="fu">beginNonFiscal</span>();</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">// Печать строк и штрихкодов</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;ИНН: 111111111111 КПП: 222222222&quot;</span>);</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;КАССА: 1               СМЕНА: 11&quot;</span>);</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;ЧЕК: 314  ДАТА: 20.11.2017 15:39&quot;</span>);</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1002</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">11</span>, <span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">0</span>}, <span class="st">&quot;https://check.egais.ru?id=cf1b1096-3cbc-11e7-b3c1-9b018b2ba3f7&quot;</span>);</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;https://check.egais.ru?id=cf1b1096-3cbc-11e7-b3c1-9b018b2ba3f7&quot;</span>);</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;&quot;</span>);</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">fptr.<span class="fu">printNormal</span>(FiscalPrinterConst.<span class="fu">FPTR_S_RECEIPT</span>, <span class="st">&quot;10 58 1c 85 bb 80 99 84 40 b1 4f 35 8a 35 3f 7c &quot;</span> +</a>
<a class="sourceLine" id="cb29-13" data-line-number="13">        <span class="st">&quot;78 b0 0a ff cd 37 c1 8e ca 04 1c 7e e7 5d b4 85 &quot;</span> +</a>
<a class="sourceLine" id="cb29-14" data-line-number="14">        <span class="st">&quot;ff d2 d6 b2 8d 7f df 48 d2 5d 81 10 de 6a 05 c9 &quot;</span> +</a>
<a class="sourceLine" id="cb29-15" data-line-number="15">        <span class="st">&quot;81 74&quot;</span>);</a>
<a class="sourceLine" id="cb29-16" data-line-number="16"></a>
<a class="sourceLine" id="cb29-17" data-line-number="17"><span class="co">// Закрытие нефискального документа</span></a>
<a class="sourceLine" id="cb29-18" data-line-number="18">fptr.<span class="fu">endNonFiscal</span>();</a></code></pre></div>
<h3 id="запросы-информации-о-ккт-и-драйвере">Запросы информации о ККТ и драйвере</h3>
<h4 id="описание-драйвера">Описание драйвера</h4>
<p>Для запроса описания драйвера нужно вызвать метод <code>getDeviceServiceDescription()</code>.</p>
<h4 id="версия-драйвера">Версия драйвера</h4>
<p>Для запроса версии драйвера нужно вызвать метод <code>getDeviceServiceVersion()</code>.</p>
<h4 id="описание-устройства">Описание устройства</h4>
<p>Для запроса описания устройства нужно вызвать метод <code>getPhysicalDeviceDescription()</code>.</p>
<h4 id="название-устройства">Название устройства</h4>
<p>Для запроса наименования устройства нужно вызвать метод <code>getPhysicalDeviceName()</code>.</p>
<h4 id="ширина-ленты-в-символах">Ширина ленты в символах</h4>
<p>Для запроса ширины ленты нужно вызвать метод <code>getMessageLength()</code>.</p>
<h4 id="количество-строк-заголовка-клише">Количество строк заголовка клише</h4>
<p>Для запроса количества строк нужно вызвать метод <code>getNumHeaderLines()</code>. Он возвращает значение настройки <strong>numHeaderLines</strong>.</p>
<h4 id="количество-строк-подвала-клише">Количество строк подвала клише</h4>
<p>Для запроса количества строк нужно вызвать метод <code>getNumTrailerLines()</code>. Он возвращает значение настройки <strong>numTrailerLines</strong>.</p>
<h3 id="запросы-состояния">Запросы состояния</h3>
<h4 id="состояние-крышки">Состояние крышки</h4>
<p>Для запроса состояния крышки нужно вызвать метод <code>getCoverOpen()</code>.</p>
<h4 id="состояние-бумаги">Состояние бумаги</h4>
<p>Для запроса состояния бумаги нужно вызвать метод <code>getRecEmpty()</code>.</p>
<h4 id="состояние-смены">Состояние смены</h4>
<p>Для запроса состояния смены нужно вызвать метод <code>getDayOpened()</code>.</p>
<h4 id="дата-и-время">Дата и время</h4>
<p>Для запроса текущих даты и времени нужно вызвать метод <code>getDate()</code> с типом запроса времени <code>FPTR_DT_RTC</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb30-1" data-line-number="1">fptr.<span class="fu">setDateType</span>(FiscalPrinterConst.<span class="fu">FPTR_DT_RTC</span>);</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">fptr.<span class="fu">getDate</span>();</a></code></pre></div>
<p>Т.к. по стандарту UPOS нельзя получить время с точносью до секунды, драйвер предоставляет <strong>directIO #1015</strong> для этого.</p>
<h4 id="дата-и-время-начала-смены">Дата и время начала смены</h4>
<p>Для запроса даты и времени начала смены нужно вызвать метод <code>getDate()</code> с типом запроса времени <code>FPTR_DT_START</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb31-1" data-line-number="1">fptr.<span class="fu">setDateType</span>(FiscalPrinterConst.<span class="fu">FPTR_DT_START</span>);</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">fptr.<span class="fu">getDate</span>();</a></code></pre></div>
<h4 id="дата-и-время-истечения-смены">Дата и время истечения смены</h4>
<p>Для запроса даты и времени истечения смены нужно вызвать метод <code>getDate()</code> с типом запроса времени <code>FPTR_DT_EOD</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb32-1" data-line-number="1">fptr.<span class="fu">setDateType</span>(FiscalPrinterConst.<span class="fu">FPTR_DT_EOD</span>);</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">fptr.<span class="fu">getDate</span>();</a></code></pre></div>
<h3 id="запросы-счетчиков">Запросы счетчиков</h3>
<h4 id="текущая-сумма-чека">Текущая сумма чека</h4>
<p>Для запроса текущей суммы чека нужно вызвать метод <code>getData()</code> с типом запроса <code>FPTR_GD_CURRENT_TOTAL</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">fptr.<span class="fu">getData</span>(FiscalPrinterConst.<span class="fu">FPTR_GD_CURRENT_TOTAL</span>, <span class="kw">null</span>, result);</a></code></pre></div>
<h4 id="номер-чека">Номер чека</h4>
<p>Для запроса номера чека нужно вызвать метод <code>getData()</code> с типом запроса <code>FPTR_GD_RECEIPT_NUMBER</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">fptr.<span class="fu">getData</span>(FiscalPrinterConst.<span class="fu">FPTR_GD_RECEIPT_NUMBER</span>, <span class="kw">null</span>, result);</a></code></pre></div>
<p>Если настройка <strong>receiptNumberType</strong> имеет значение <strong>0</strong>, то возвращается номер чека в смене. Если она равна <strong>1</strong>, то возвращается номер документа из ФН.</p>
<h4 id="номер-смены">Номер смены</h4>
<p>Для запроса номера смены нужно вызвать метод <code>getData()</code> с типом запроса <code>FPTR_GD_Z_REPORT</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">fptr.<span class="fu">getData</span>(FiscalPrinterConst.<span class="fu">FPTR_GD_Z_REPORT</span>, <span class="kw">null</span>, result);</a></code></pre></div>
<h4 id="заводской-номер-ккт">Заводской номер ККТ</h4>
<p>Для запроса заводского номера ККТ нужно вызвать метод <code>getData()</code> с типом запроса <code>FPTR_GD_PRINTER_ID</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">fptr.<span class="fu">getData</span>(FiscalPrinterConst.<span class="fu">FPTR_GD_PRINTER_ID</span>, <span class="kw">null</span>, result);</a></code></pre></div>
<h4 id="версия-по-ккт">Версия ПО ККТ</h4>
<p>Для запроса версии ПО ККТ нужно вызвать метод <code>getData()</code> с типом запроса <code>FPTR_GD_FIRMWARE</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">fptr.<span class="fu">getData</span>(FiscalPrinterConst.<span class="fu">FPTR_GD_FIRMWARE</span>, <span class="kw">null</span>, result);</a></code></pre></div>
<h2 id="обработка-ошибок">Обработка ошибок</h2>
<p>Драйвер возвращает ошибки в виде исключений <code>jpos.JposExeption</code>. Если ошибку вызвал обмен с ККТ, то поле <code>origException</code> будет содержать ошибку драйвера в виде исключения <code>ru.atol.drivers10.jpos.fptr.errors.DriverException</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">try</span> {</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">    ...</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="kw">catch</span> (JposException e) {</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="kw">if</span> (e.<span class="fu">getOrigException</span>() <span class="kw">instanceof</span> ru.<span class="fu">atol</span>.<span class="fu">drivers10</span>.<span class="fu">jpos</span>.<span class="fu">fptr</span>.<span class="fu">errors</span>.<span class="fu">DriverException</span>) {</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;Driver error = </span><span class="sc">%d</span><span class="st"> [</span><span class="sc">%s</span><span class="st">]&quot;</span>, ((ru.<span class="fu">atol</span>.<span class="fu">drivers10</span>.<span class="fu">jpos</span>.<span class="fu">fptr</span>.<span class="fu">errors</span>.<span class="fu">DriverException</span>)e.<span class="fu">getOrigException</span>()).<span class="fu">getErrorCode</span>(), e.<span class="fu">getMessage</span>()));</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">    } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;JposException = </span><span class="sc">%s</span><span class="st">&quot;</span>, e.<span class="fu">getMessage</span>()));</a>
<a class="sourceLine" id="cb38-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb38-10" data-line-number="10">}</a></code></pre></div>
<h2 id="расширенный-функционал-directio">Расширенный функционал (directIO)</h2>
<h3 id="печать-текста-с-форматированием">1001 - печать текста с форматированием</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - выравнивание
<ul>
<li><strong>0</strong> - слева</li>
<li><strong>1</strong> - по центру</li>
<li><strong>2</strong> - справа</li>
</ul></li>
<li><code>data[1]</code> - двойная ширина</li>
<li><code>data[2]</code> - двойная высота</li>
<li><code>data[3]</code> - зарезервировано</li>
<li><code>data[4]</code> - шрифт</li>
<li><code>data[5]</code> - режим кеширования строки (если параметр передан и не равен -1, то значение параметра интерпретируется аналогично настройке cacheRecMessages)</li>
<li><code>object</code> - текст</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="dt">int</span> alignment = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="dt">int</span> doubleWidth = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="dt">int</span> doubleHeight = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="dt">int</span> font = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="dt">int</span> modeCachingStr = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="bu">String</span> text = <span class="st">&quot;Строка&quot;</span>;</a>
<a class="sourceLine" id="cb39-7" data-line-number="7"></a>
<a class="sourceLine" id="cb39-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1001</span>, <span class="kw">new</span> <span class="dt">int</span>[]{alignment, doubleWidth, doubleHeight, <span class="dv">0</span>, font, modeCachingStr}, text);</a></code></pre></div>
<h3 id="печать-штрихкода-2">1002 - печать штрихкода</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - тип ШК
<ul>
<li><strong>0</strong> - EAN8</li>
<li><strong>1</strong> - EAN13</li>
<li><strong>2</strong> - UPCA</li>
<li><strong>3</strong> - UPCE</li>
<li><strong>4</strong> - CODE39</li>
<li><strong>5</strong> - CODE93</li>
<li><strong>6</strong> - CODE128</li>
<li><strong>7</strong> - CODABAR</li>
<li><strong>8</strong> - ITF</li>
<li><strong>9</strong> - ITF14</li>
<li><strong>11</strong> - QR</li>
<li><strong>12</strong> - PDF417</li>
<li><strong>14</strong> - CODE39_EXTENDED</li>
</ul></li>
<li><code>data[1]</code> - коэфициент увеличения</li>
<li><code>data[2]</code> - высота (для одномерных ШК)</li>
<li><code>data[3]</code> - печатать текст ШК</li>
<li><code>data[4]</code> - выравнивание
<ul>
<li><strong>0</strong> - слева</li>
<li><strong>1</strong> - по центру</li>
<li><strong>2</strong> - справа</li>
</ul></li>
<li><code>data[5]</code> - режим кеширования строки (если параметр передан и не равен -1, то значение параметра интерпретируется аналогично настройке cacheRecMessages)</li>
<li><code>object</code> - данные ШК</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="dt">int</span> type = <span class="dv">11</span>;</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="dt">int</span> height = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="dt">int</span> printText = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="dt">int</span> scale = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="dt">int</span> alignment = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="dt">int</span> modeCachingStr = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="bu">String</span> data = <span class="st">&quot;qrdata&quot;</span>;</a>
<a class="sourceLine" id="cb40-8" data-line-number="8"></a>
<a class="sourceLine" id="cb40-9" data-line-number="9">fptr.<span class="fu">directIO</span>(<span class="dv">1002</span>, <span class="kw">new</span> <span class="dt">int</span>[]{type, scale, height, printText, alignment, modeCachingStr}, data);</a></code></pre></div>
<h3 id="открытие-смены">1003 - открытие смены</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb41-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1003</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="чтение-настройки-ккт">1004 - чтение настройки ККТ</h3>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер настройки (см. документацию на драйвер ККТ, раздел <strong>Настройки ККТ</strong>.</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - значение настройки</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="dt">int</span> settingsID = <span class="dv">273</span>;</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb42-3" data-line-number="3"></a>
<a class="sourceLine" id="cb42-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1004</span>, <span class="kw">new</span> <span class="dt">int</span>[]{settingsID}, result);</a></code></pre></div>
<h3 id="запись-настройки-ккт">1005 - запись настройки ККТ</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер настройки (см. документацию на драйвер ККТ, раздел <strong>Настройки ККТ</strong>.</li>
<li><code>object</code> - значение настройки</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="dt">int</span> settingsID = <span class="dv">273</span>;</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="bu">String</span> settingValue = <span class="st">&quot;ofdp.platformaofd.ru&quot;</span>;</a>
<a class="sourceLine" id="cb43-3" data-line-number="3"></a>
<a class="sourceLine" id="cb43-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1005</span>, <span class="kw">new</span> <span class="dt">int</span>[]{settingsID}, settingValue);</a></code></pre></div>
<h3 id="применить-настройки-ккт">1006 - применить настройки ККТ</h3>
<p>Применяет настройки, записанные с помощью <strong>directIO #1005</strong></p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb44-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1006</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="запрос-информации-о-последнем-документе">1007 - запрос информации о последнем документе</h3>
<p>Тип <code>object</code> - <strong>String[3]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - номер ФД</li>
<li><code>object[1]</code> - ФПД</li>
<li><code>object[2]</code> - дата и время (формат - <em>ddMMyyyyHHmm</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"></a>
<a class="sourceLine" id="cb45-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1007</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb45-4" data-line-number="4"></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="bu">String</span> documentNumber = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="bu">String</span> documentSign = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="bu">String</span> documentDateTime = result[<span class="dv">2</span>];</a></code></pre></div>
<h3 id="запрос-квитанции-офд">1008 - запрос квитанции ОФД</h3>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер ФД</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - ФПД ОФД</li>
<li><code>object[1]</code> - дата и время (формат - <em>ddMMyyyyHHmm</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="dt">int</span> documentNumber = <span class="dv">12</span>;</a>
<a class="sourceLine" id="cb46-3" data-line-number="3"></a>
<a class="sourceLine" id="cb46-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1008</span>, <span class="kw">new</span> <span class="dt">int</span>[]{documentNumber}, result);</a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="bu">String</span> ofdSign = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb46-6" data-line-number="6"><span class="bu">String</span> ticketDateTime = result[<span class="dv">1</span>];</a></code></pre></div>
<h3 id="отключение-печати-чека-или-отчёта">1009 - отключение печати чека или отчёта</h3>
<p>Вызов directIO отключает печать следующего или текущего чека, а также отчёта об открытии или закрытии смены.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - тип документа, для которого отменяется печать
<ul>
<li><strong>0 (или data == null)</strong> - чек</li>
<li><strong>1</strong> - отчёт об открытии смены</li>
<li><strong>2</strong> - отчёт о закрытии смены</li>
</ul></li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример отключения печати чека:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb47-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1009</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<p>Пример отключения печати отчёта об открытии смены:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="dt">int</span> documentType = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"></a>
<a class="sourceLine" id="cb48-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1009</span>, <span class="kw">new</span> <span class="dt">int</span>[]{documentType}, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="добавление-реквизита-чека">1010 - добавление реквизита чека</h3>
<p>Выполняется только при открытом чеке.</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер реквизита. Возможные значения:
<ul>
<li>1 - телефон или email получателя (тег ФН 1008). Тип - строка;</li>
<li>2 - наименование получателя (тег ФН 1227). Тип - строка;</li>
<li>3 - ИНН получателя (тег ФН 1228). Тип - строка;</li>
<li>4 - email отправителя чека (тег ФН 1117). Тип - строка;</li>
<li>5 - система налогообложения (тег ФН 1055). Тип - число. Может принимать значения:
<ul>
<li>1 - ОСН;</li>
<li>2 - упрощенная Доход;</li>
<li>4 - упрощенная Доход минус Расход;</li>
<li>16 - ЕСН;</li>
<li>32 - патент.</li>
</ul></li>
<li>6 - место расчетов (тег ФН 1187). Тип - строка;</li>
<li>7 - признак агента (тег ФН 1057). Тип - число. Может принимать комбинацию следующих значений:
<ul>
<li>0 - не агент;</li>
<li>1 - банковский платежный агент;</li>
<li>2 - банковский платежный субагент;</li>
<li>4 - платежный агент;</li>
<li>8 - платежный субагент;</li>
<li>16 - поверенный;</li>
<li>32 - комиссионер;</li>
<li>64 - агент.</li>
</ul></li>
<li>8 - телефон поставщика (тег ФН 1171) (может повторяться). Тип - строка;</li>
<li>9 - операция платежного агента (тег ФН 1044). Тип - строка;</li>
<li>10 - телефон платежного агента (тег ФН 1073) (может повторяться). Тип - строка;</li>
<li>11 - адрес оператора перевода (тег ФН 1005). Тип - строка;</li>
<li>12 - ИНН оператора перевода (тег ФН 1016). Тип - строка;</li>
<li>13 - наименование оператора перевода (тег ФН 1026). Тип - строка;</li>
<li>14 - телефон оператора перевода (тег ФН 1075) (может повторяться). Тип - строка;</li>
<li>15 - телефон оператора по приему платежей (тег ФН 1074) (может повторяться). Тип - строка;</li>
<li>18 - наименование дополнительного реквизита пользователя (тег ФН 1085). Тип - строка;</li>
<li>19 - значение дополнительного реквизита пользователя (тег ФН 1086). Тип - строка;</li>
<li>20 - тип коррекции (тег ФН 1173). Тип - число. Возможные значения:
<ul>
<li>0 - самостоятельно;</li>
<li>1 - по предписанию.</li>
</ul></li>
<li>22 - дата документа основания для коррекции (тег ФН 1178). Тип - дата / время;</li>
<li>23 - номер документа основания для коррекции (тег ФН 1179). Тип - строка;</li>
<li>24 - дополнительный реквизит чека (БСО) (тег ФН 1192). Тип - строка;</li>
<li>25 - номер автомата (тег ФН 1036). Тип - строка.</li>
<li>26 - адрес расчётов (тег ФН 1009). Тип - строка.</li>
</ul></li>
<li><code>data[1]</code> - тип реквизита
<ul>
<li>0 - целое число. Значение в <code>object</code> должно быть строкой с числом - “123”;</li>
<li>1 - строка. Значение в <code>object</code> - произвольная строка;</li>
<li>2 - дробное число. Значение в <code>object</code> должно быть строкой с числом - “1.23”;</li>
<li>4 - дата / время. Значение в <code>object</code> должно быть строкой с датой, формат - <em>ddMMyyyyHHmmss</em>.</li>
</ul></li>
<li><code>object</code> - значение реквизита.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="dt">int</span> attrNumber = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="dt">int</span> attrType = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="bu">String</span> attrValue = <span class="st">&quot;user@mail.ru&quot;</span>;</a>
<a class="sourceLine" id="cb49-4" data-line-number="4"></a>
<a class="sourceLine" id="cb49-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1010</span>, <span class="kw">new</span> <span class="dt">int</span>[]{attrNumber, attrType}, attrValue);</a></code></pre></div>
<h3 id="добавление-реквизита-позиции">1011 - добавление реквизита позиции</h3>
<p>Выполняется только при открытом чеке. Вызывать нужно <em>ДО</em> регистрации позиции, к которой реквизиты должны быть применены.</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер реквизита. Возможные значения:
<ul>
<li>1 - код товара (тег ФН 1162). Тип - массив байтов;</li>
<li>2 - единицы измерения предмета расчета (тег ФН 1197 для ФФД &lt; 1.2 или тег ФН 2108). Тип - строка;</li>
<li>3 - признак предмета расчета (тег ФН 1212). Тип - число;</li>
<li>4 - признак способа расчета (тег ФН 1214). Тип - число;</li>
<li>5 - сумма акциза (тег ФН 1229). Тип - дробное число;</li>
<li>6 - код страны происхождения (тег ФН 1230). Тип - строка;</li>
<li>7 - признак агента (тег ФН 1222). Тип - число. Может принимать одно из следующих значений:
<ul>
<li>1 - банковский платежный агент;</li>
<li>2 - банковский платежный субагент;</li>
<li>4 - платежный агент;</li>
<li>8 - платежный субагент;</li>
<li>16 - поверенный;</li>
<li>32 - комиссионер;</li>
<li>64 - агент.</li>
</ul></li>
<li>8 - телефон поставщика (тег ФН 1171) (может повторяться). Тип - строка;</li>
<li>9 - операция платежного агента (тег ФН 1044). Тип - строка;</li>
<li>10 - телефон платежного агента (тег ФН 1073) (может повторяться). Тип - строка;</li>
<li>11 - адрес оператора перевода (тег ФН 1005). Тип - строка;</li>
<li>12 - ИНН оператора перевода (тег ФН 1016). Тип - строка;</li>
<li>13 - наименование оператора перевода (тег ФН 1026). Тип - строка;</li>
<li>14 - телефон оператора перевода (тег ФН 1075) (может повторяться). Тип - строка;</li>
<li>15 - телефон оператора по приему платежей (тег ФН 1074) (может повторяться). Тип - строка;</li>
<li>16 - наименование поставщика (тег ФН 1225). Тип - строка;</li>
<li>17 - ИНН поставщика (тег ФН 1226). Тип - строка;</li>
<li>18 - номер таможенной декларации (тег ФН 1231). Тип - строка;</li>
<li>19 - дополнительный реквизит предмета расчета (тег ФН 1191). Тип - строка.</li>
</ul></li>
<li><code>data[1]</code> - тип реквизита
<ul>
<li>0 - целое число. Значение в <code>object</code> должно быть строкой с числом - “123”;</li>
<li>1 - строка. Значение в <code>object</code> - произвольная строка;</li>
<li>2 - дробное число. Значение в <code>object</code> должно быть строкой с числом - “1.23”;</li>
<li>3 - массив байтов. Значение в <code>object</code> должно быть строкой с hex-представлением байтов, без разделителей - “0102FFAA”;</li>
<li>4 - дата / время. Значение в <code>object</code> должно быть строкой с датой, формат - <em>ddMMyyyyHHmmss</em>.</li>
</ul></li>
<li><code>object</code> - значение реквизита.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="dt">int</span> attrNumber = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="dt">int</span> attrType = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="bu">String</span> attrValue = <span class="st">&quot;1&quot;</span>;</a>
<a class="sourceLine" id="cb50-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb50-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1011</span>, <span class="kw">new</span> <span class="dt">int</span>[]{attrNumber, attrType}, attrValue);</a></code></pre></div>
<h3 id="открыть-денежный-ящик">1012 - открыть денежный ящик</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb51-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1012</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="статус-денежного-ящика">1013 - статус денежного ящика</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - 1, если денежный ящик открыт, 0 - если закрыт. На значение влияет настройка <strong>invertCashDrawerStatus</strong>.</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb52-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1013</span>, result, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="dt">int</span> status = result[<span class="dv">0</span>];</a></code></pre></div>
<h3 id="печать-документа-из-фн-по-номеру">1014 - печать документа из ФН по номеру</h3>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер документа.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="dt">int</span> documentNumber = <span class="dv">12</span>;</a>
<a class="sourceLine" id="cb53-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb53-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1014</span>, <span class="kw">new</span> <span class="dt">int</span>[]{documentNumber}, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="чтение-даты-и-времени-с-точностью-до-секунд">1015 - чтение даты и времени (с точностью до секунд)</h3>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - дата и время (формат - <em>ddMMyyyyHHmmss</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb54-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1015</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="bu">String</span> dateTime = result[<span class="dv">0</span>];</a></code></pre></div>
<h3 id="запись-даты-и-времени-с-точностью-до-секунд">1016 - запись даты и времени (с точностью до секунд)</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - дата и время (формат - <em>ddMMyyyyHHmmss</em>)</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="bu">String</span> dateTime = <span class="st">&quot;01012019010203&quot;</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb55-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1016</span>, <span class="kw">null</span>, dateTime);</a></code></pre></div>
<h3 id="чтение-реквизитов-регистрации-ккт">1017 - чтение реквизитов регистрации ККТ</h3>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер реквизита. Может принимать значения:
<ul>
<li>1001 - признак автоматического режима;</li>
<li>1002 - признак автономного режима;</li>
<li>1009 - адрес расчетов;</li>
<li>1012 - дата и время регистрации;</li>
<li>1017 - ИНН ОФД;</li>
<li>1018 - ИНН организации;</li>
<li>1036 - номер автомата;</li>
<li>1037 - регистрационный номер устройства;</li>
<li>1046 - название ОФД;</li>
<li>1048 - название организации;</li>
<li>1056 - признак шифрования;</li>
<li>1057 - признак агента;</li>
<li>1060 - адрес сайта ФНС;</li>
<li>1062 - системы налогообложения;</li>
<li>1108 - признак ККТ для расчетов в сети Интернет;</li>
<li>1109 - признак расчетов за услуги;</li>
<li>1110 - признак АС БСО;</li>
<li>1117 - e-mail организации;</li>
<li>1126 - признак проведения лотерей;</li>
<li>1187 - адрес места расчетов;</li>
<li>1193 - признак проведения азартных игр;</li>
<li>1207 - признак подакцизного товара;</li>
<li>1209 - версия ФФД;</li>
<li>1221 - признак установки в автомате.</li>
</ul></li>
<li><code>data[1]</code> - тип реквизита
<ul>
<li>0 - целое число. Значение в <code>object</code> должно быть строкой с числом - “123”;</li>
<li>1 - строка. Значение в <code>object</code> - произвольная строка.</li>
</ul></li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - значение реквизита</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="dt">int</span> attrNumber = <span class="dv">1009</span>;</a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="dt">int</span> attrType = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb56-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb56-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1017</span>, <span class="kw">new</span> <span class="dt">int</span>[]{attrNumber, attrType}, result);</a>
<a class="sourceLine" id="cb56-6" data-line-number="6"><span class="bu">String</span> attrValue = result[<span class="dv">0</span>];</a></code></pre></div>
<h3 id="чтение-сменных-счетчиков">1020 - чтение сменных счетчиков</h3>
<p>Считывает все сменные счетчики из ККТ. Если какой-либо из счетчиков считать не удалось, в соответствующем элементе списка возвращается <code>null</code>. Формат всех сумм, возвращаемых этим directIO, подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<p>Тип <code>object</code> - <strong>List<String></strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - номер смены;</li>
<li><code>object[1]</code> - сумма наличных в ДЯ;</li>
<li><code>object[2]</code> - сумма внесений;</li>
<li><code>object[3]</code> - количество внесений;</li>
<li><code>object[4]</code> - сумма выплат;</li>
<li><code>object[5]</code> - количество выплат;</li>
<li><code>object[6]</code> - количество чеков прихода;</li>
<li><code>object[7]</code> - сумма оплат чеков прихода наличными;</li>
<li><code>object[8]</code> - сумма оплат чеков прихода безналичными;</li>
<li><code>object[9]</code> - сумма оплат чеков прихода авансом;</li>
<li><code>object[10]</code> - сумма оплат чеков прихода кредитом;</li>
<li><code>object[11]</code> - сумма оплат чеков прихода встречным предоставлением;</li>
<li><code>object[12]</code> - сумма оплат чеков прихода пользовательским типом оплаты #1;</li>
<li><code>object[13]</code> - сумма оплат чеков прихода пользовательским типом оплаты #2;</li>
<li><code>object[14]</code> - сумма оплат чеков прихода пользовательским типом оплаты #3;</li>
<li><code>object[15]</code> - сумма оплат чеков прихода пользовательским типом оплаты #4;</li>
<li><code>object[16]</code> - сумма оплат чеков прихода пользовательским типом оплаты #5;</li>
<li><code>object[17]</code> - количество чеков расхода;</li>
<li><code>object[18]</code> - сумма оплат чеков расхода наличными;</li>
<li><code>object[19]</code> - сумма оплат чеков расхода безналичными;</li>
<li><code>object[20]</code> - сумма оплат чеков расхода авансом;</li>
<li><code>object[21]</code> - сумма оплат чеков расхода кредитом;</li>
<li><code>object[22]</code> - сумма оплат чеков расхода встречным предоставлением;</li>
<li><code>object[23]</code> - сумма оплат чеков расхода пользовательским типом оплаты #1;</li>
<li><code>object[24]</code> - сумма оплат чеков расхода пользовательским типом оплаты #2;</li>
<li><code>object[25]</code> - сумма оплат чеков расхода пользовательским типом оплаты #3;</li>
<li><code>object[26]</code> - сумма оплат чеков расхода пользовательским типом оплаты #4;</li>
<li><code>object[27]</code> - сумма оплат чеков расхода пользовательским типом оплаты #5;</li>
<li><code>object[28]</code> - количество чеков возврата прихода;</li>
<li><code>object[29]</code> - сумма оплат чеков возврата прихода наличными;</li>
<li><code>object[30]</code> - сумма оплат чеков возврата прихода безналичными;</li>
<li><code>object[31]</code> - сумма оплат чеков возврата прихода авансом;</li>
<li><code>object[32]</code> - сумма оплат чеков возврата прихода кредитом;</li>
<li><code>object[33]</code> - сумма оплат чеков возврата прихода встречным предоставлением;</li>
<li><code>object[34]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #1;</li>
<li><code>object[35]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #2;</li>
<li><code>object[36]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #3;</li>
<li><code>object[37]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #4;</li>
<li><code>object[38]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #5;</li>
<li><code>object[39]</code> - количество чеков возврата расхода;</li>
<li><code>object[40]</code> - сумма оплат чеков возврата расхода наличными;</li>
<li><code>object[41]</code> - сумма оплат чеков возврата расхода безналичными;</li>
<li><code>object[42]</code> - сумма оплат чеков возврата расхода авансом;</li>
<li><code>object[43]</code> - сумма оплат чеков возврата расхода кредитом;</li>
<li><code>object[44]</code> - сумма оплат чеков возврата расхода встречным предоставлением;</li>
<li><code>object[45]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #1;</li>
<li><code>object[46]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #2;</li>
<li><code>object[47]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #3;</li>
<li><code>object[48]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #4;</li>
<li><code>object[49]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #5.</li>
<li><code>object[50]</code> - количество чеков коррекции прихода;</li>
<li><code>object[51]</code> - сумма сменного итога чеков коррекции прихода;</li>
<li><code>object[52]</code> - количество чеков коррекции расхода;</li>
<li><code>object[53]</code> - сумма сменного итога чеков коррекции расхода;</li>
<li><code>object[54]</code> - количество аннулированных чеков;</li>
<li><code>object[55]</code> - сумма аннулированных чеков;</li>
<li><code>object[56]</code> - количество фискальных документов (только для закрытой смены);</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="bu">List</span>&lt;<span class="bu">String</span>&gt; result = <span class="kw">new</span> <span class="bu">LinkedList</span>&lt;&gt;();</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1020</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb57-3" data-line-number="3"></a>
<a class="sourceLine" id="cb57-4" data-line-number="4"><span class="dt">int</span> shiftNumber = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(result.<span class="fu">get</span>(<span class="dv">0</span>));</a>
<a class="sourceLine" id="cb57-5" data-line-number="5">...</a></code></pre></div>
<h3 id="чтение-необнуляемых-итогов">1021 - чтение необнуляемых итогов</h3>
<p>Считывает необнуляемые итоги из ККТ. Если какой-либо из счетчиков считатать не удалось, в соответствующем элементе списка возвращается <code>null</code>. Формат всех сумм, возвращаемых этим directIO, подчиняется настройке <strong>amountDecimalPlaces</strong>.</p>
<p>Тип <code>object</code> - <strong>List<String></strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - сумма оплат чеков прихода наличными;</li>
<li><code>object[1]</code> - сумма оплат чеков прихода безналичными;</li>
<li><code>object[2]</code> - сумма оплат чеков прихода авансом;</li>
<li><code>object[3]</code> - сумма оплат чеков прихода кредитом;</li>
<li><code>object[4]</code> - сумма оплат чеков прихода встречным предоставлением;</li>
<li><code>object[5]</code> - сумма оплат чеков прихода пользовательским типом оплаты #1;</li>
<li><code>object[6]</code> - сумма оплат чеков прихода пользовательским типом оплаты #2;</li>
<li><code>object[7]</code> - сумма оплат чеков прихода пользовательским типом оплаты #3;</li>
<li><code>object[8]</code> - сумма оплат чеков прихода пользовательским типом оплаты #4;</li>
<li><code>object[9]</code> - сумма оплат чеков прихода пользовательским типом оплаты #5;</li>
<li><code>object[10]</code> - сумма оплат чеков расхода наличными;</li>
<li><code>object[11]</code> - сумма оплат чеков расхода безналичными;</li>
<li><code>object[12]</code> - сумма оплат чеков расхода авансом;</li>
<li><code>object[13]</code> - сумма оплат чеков расхода кредитом;</li>
<li><code>object[14]</code> - сумма оплат чеков расхода встречным предоставлением;</li>
<li><code>object[15]</code> - сумма оплат чеков расхода пользовательским типом оплаты #1;</li>
<li><code>object[16]</code> - сумма оплат чеков расхода пользовательским типом оплаты #2;</li>
<li><code>object[17]</code> - сумма оплат чеков расхода пользовательским типом оплаты #3;</li>
<li><code>object[18]</code> - сумма оплат чеков расхода пользовательским типом оплаты #4;</li>
<li><code>object[19]</code> - сумма оплат чеков расхода пользовательским типом оплаты #5;</li>
<li><code>object[20]</code> - сумма оплат чеков возврата прихода наличными;</li>
<li><code>object[21]</code> - сумма оплат чеков возврата прихода безналичными;</li>
<li><code>object[22]</code> - сумма оплат чеков возврата прихода авансом;</li>
<li><code>object[23]</code> - сумма оплат чеков возврата прихода кредитом;</li>
<li><code>object[24]</code> - сумма оплат чеков возврата прихода встречным предоставлением;</li>
<li><code>object[25]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #1;</li>
<li><code>object[26]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #2;</li>
<li><code>object[27]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #3;</li>
<li><code>object[28]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #4;</li>
<li><code>object[29]</code> - сумма оплат чеков возврата прихода пользовательским типом оплаты #5;</li>
<li><code>object[30]</code> - сумма оплат чеков возврата расхода наличными;</li>
<li><code>object[31]</code> - сумма оплат чеков возврата расхода безналичными;</li>
<li><code>object[32]</code> - сумма оплат чеков возврата расхода авансом;</li>
<li><code>object[33]</code> - сумма оплат чеков возврата расхода кредитом;</li>
<li><code>object[34]</code> - сумма оплат чеков возврата расхода встречным предоставлением;</li>
<li><code>object[35]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #1;</li>
<li><code>object[36]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #2;</li>
<li><code>object[37]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #3;</li>
<li><code>object[38]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #4;</li>
<li><code>object[39]</code> - сумма оплат чеков возврата расхода пользовательским типом оплаты #5;</li>
<li><code>object[40]</code> - сумма оплат чеков коррекции прихода;</li>
<li><code>object[41]</code> - сумма оплат чеков коррекции расхода;</li>
<li><code>object[42]</code> - сумма оплат чеков коррекции возврата прихода;</li>
<li><code>object[43]</code> - сумма оплат чеков коррекции возврата расхода.</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="bu">List</span>&lt;<span class="bu">String</span>&gt; result = <span class="kw">new</span> <span class="bu">LinkedList</span>&lt;&gt;();</a>
<a class="sourceLine" id="cb58-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1021</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb58-3" data-line-number="3"></a>
<a class="sourceLine" id="cb58-4" data-line-number="4"><span class="dt">double</span> shiftNumber = <span class="bu">Double</span>.<span class="fu">parseDouble</span>(result.<span class="fu">get</span>(<span class="dv">0</span>));</a>
<a class="sourceLine" id="cb58-5" data-line-number="5">...</a></code></pre></div>
<h3 id="запрос-информации-о-фн">1022 - запрос информации о ФН</h3>
<p>Тип <code>object</code> - <strong>String[5]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - серийный номер ФН</li>
<li><code>object[1]</code> - версия ФН</li>
<li><code>object[2]</code> - тип ФН</li>
<li><code>object[3]</code> - состояние ФН</li>
<li><code>object[4]</code> - флаги ФН</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb59-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1022</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb59-4" data-line-number="4"><span class="bu">String</span> serial = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb59-5" data-line-number="5"><span class="bu">String</span> version = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb59-6" data-line-number="6"><span class="bu">String</span> type = result[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb59-7" data-line-number="7"><span class="bu">String</span> state = result[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb59-8" data-line-number="8"><span class="bu">String</span> flags = result[<span class="dv">4</span>];</a></code></pre></div>
<h3 id="запрос-статуса-обмена-с-офд">1023 - запрос статуса обмена с ОФД</h3>
<p>Тип <code>object</code> - <strong>String[4]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - статус обмена</li>
<li><code>object[1]</code> - количество неотправленных ФД</li>
<li><code>object[2]</code> - номер первого неотправленного ФД</li>
<li><code>object[3]</code> - дата и время первого неотправленного ФД (формат - <em>ddMMyyyyHHmm</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb60-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1023</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="bu">String</span> status = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="bu">String</span> documentsCount = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb60-6" data-line-number="6"><span class="bu">String</span> documentNumber = result[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb60-7" data-line-number="7"><span class="bu">String</span> documentDateTime = result[<span class="dv">3</span>];</a></code></pre></div>
<h3 id="запрос-срока-действия-фн">1024 - запрос срока действия ФН</h3>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - дата и время окончания срока действия (формат - <em>ddMMyyyyHHmm</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb61-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb61-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1024</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="bu">String</span> dateTime = result[<span class="dv">0</span>];</a></code></pre></div>
<h3 id="запись-произвольного-поля-в-json-чека">1025 - запись произвольного поля в JSON чека</h3>
<p>Позволяет запись в формируемый JPOS-драйвером JSON произвольное поле, которое в дальнейшем нужно обработать на уровне пользовательских скриптов драйвера. Поля можно записать в:</p>
<ul>
<li>позиции (перед методами <code>printRecItemXXX()</code>)</li>
<li>оплатами (перед методом <code>printRecTotal())</code>)</li>
<li>закрытие чека (перед методом <code>endFiscalReceipt()</code>)</li>
</ul>
<p>Путь к пользовательским скриптам нужно прописать в настройку <strong>scriptsPath</strong> драйвера.</p>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - ключ</li>
<li><code>object[1]</code> - значение</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="bu">String</span>[] userProperty = <span class="kw">new</span> <span class="bu">String</span>[]{<span class="st">&quot;myUserAttribute&quot;</span>, <span class="st">&quot;myUserAttributeValue&quot;</span>};</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb62-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1025</span>, <span class="kw">null</span>, userProperty);</a></code></pre></div>
<h3 id="регистрация-налога-на-чек-1">1026 - регистрация налога на чек</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер ставки налога (одно из значений соответствующих настроек драйвера);</li>
<li><code>object</code> - сумма налога (формат подчиняется настройке <strong>amountDecimalPlaces</strong>).</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="dt">int</span> vatID = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="bu">String</span> vatValue = <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">100000</span>);</a>
<a class="sourceLine" id="cb63-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb63-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1026</span>, <span class="kw">new</span> <span class="dt">int</span>[]{vatID}, vatValue);</a></code></pre></div>
<h3 id="установка-инн-кассира">1027 - установка ИНН кассира</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - ИНН кассира.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="bu">String</span> operatorVATIN = <span class="st">&quot;123456789047&quot;</span>;</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb64-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1027</span>, <span class="kw">null</span>, operatorVATIN);</a></code></pre></div>
<h3 id="запись-кода-табачной-продукции">1029 - запись кода табачной продукции</h3>
<blockquote>
<p><strong>ВАЖНО</strong>: С помощью этого directIO можно сформировать код табачной продукции ТОЛЬКО старого образца. Рекомендуется использовать directIO #1040 или directIO #1039.</p>
</blockquote>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификтор продукта GTIN;</li>
<li><code>object[1]</code> - код идентификации.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="bu">String</span> gtin = <span class="st">&quot;98765432101234&quot;</span>;</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="bu">String</span> code = <span class="st">&quot;ABC1234&quot;</span>;</a>
<a class="sourceLine" id="cb65-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb65-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1029</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{gtin, code});</a></code></pre></div>
<p>Выполнять операцию нужно непосредственно перед регистрацией позиции, к которой код товара относится.</p>
<h3 id="запись-кода-лекарства">1030 - запись кода лекарства</h3>
<blockquote>
<p><strong>ВАЖНО</strong>: С помощью этого directIO можно сформировать код лекарства ТОЛЬКО старого образца. Рекомендуется использовать directIO #1040 или directIO #1039.</p>
</blockquote>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификтор продукта GTIN;</li>
<li><code>object[1]</code> - контрольный (идентификационный) знак (КиЗ).</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="bu">String</span> gtin = <span class="st">&quot;98765432101234&quot;</span>;</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="bu">String</span> code = <span class="st">&quot;ABC1234567890&quot;</span>;</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb66-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1030</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{gtin, code});</a></code></pre></div>
<p>Выполнять операцию нужно непосредственно перед регистрацией позиции, к которой код товара относится.</p>
<h3 id="запись-кода-меховой-продукции">1031 - запись кода меховой продукции</h3>
<blockquote>
<p><strong>ВАЖНО</strong>: С помощью этого directIO можно сформировать код меховой продукции ТОЛЬКО старого образца. Рекомендуется использовать directIO #1040 или directIO #1039.</p>
</blockquote>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификтор продукта GTIN;</li>
<li><code>object[1]</code> - серийный номер.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="bu">String</span> gtin = <span class="st">&quot;98765432101234&quot;</span>;</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="bu">String</span> code = <span class="st">&quot;RU-430302-ABC1234567&quot;</span>;</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"> </a>
<a class="sourceLine" id="cb67-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1031</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{gtin, code});</a></code></pre></div>
<p>Выполнять операцию нужно непосредственно перед регистрацией позиции, к которой код товара относится.</p>
<h3 id="запрос-суммы-налогов-за-последний-чек">1032 - запрос суммы налогов за последний чек</h3>
<p>Тип <code>object</code> - <strong>String[6]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - сумма по ставке “НДС 20%”</li>
<li><code>object[1]</code> - сумма по ставке “НДС 10%”</li>
<li><code>object[2]</code> - сумма по ставке “НДС расчитанный 20/120”</li>
<li><code>object[3]</code> - сумма по ставке “НДС расчитанный 10/110”</li>
<li><code>object[4]</code> - оборот по ставке “НДС 0%”</li>
<li><code>object[5]</code> - оборот по ставке “НДС не облагается”</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="bu">String</span>[] vatValues = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">6</span>];</a>
<a class="sourceLine" id="cb68-2" data-line-number="2"></a>
<a class="sourceLine" id="cb68-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1032</span>, <span class="kw">null</span>, vatValues);</a></code></pre></div>
<h3 id="регистрация-налога-на-позицию">1033 - регистрация налога на позицию</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - сумма налога (формат подчиняется настройке <strong>amountDecimalPlaces</strong>).</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="bu">String</span> vatValue = <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">10000</span>);</a>
<a class="sourceLine" id="cb69-2" data-line-number="2"></a>
<a class="sourceLine" id="cb69-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1033</span>, <span class="kw">null</span>, vatValue);</a></code></pre></div>
<p>Выполнять операцию нужно после регистрации позиции, к которой налог относится.</p>
<h3 id="перевод-чека-в-режим-ндс18">1034 - перевод чека в режим НДС18</h3>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - 1, если регистрировать позиции со ставками НДС 18 (18/118), 0, если со ставками НДС 20 (20/120). Флаг имеет смысл после 2019.01.01.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb70-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1034</span>, <span class="kw">new</span> <span class="dt">int</span>[]{<span class="dv">1</span>}, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="запрос-состояния-смены">1035 - запрос состояния смены</h3>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - состояние смены (0 - закрыта, 1 - открыта, 2 - истекла)</li>
<li><code>data[1]</code> - если смена закрыта, то номер последней закрытой смены. Если смена открыта или истекла - номер текущей смены.</li>
<li><code>object[0]</code> - дата и время истечения текущей смены (формат - <em>ddMMyyyyHHmmss</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="dt">int</span>[] intParams = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="bu">String</span>[] stringParams = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1035</span>, intParams, stringParams);</a>
<a class="sourceLine" id="cb71-4" data-line-number="4"></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="dt">int</span> shiftState = intParams[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb71-6" data-line-number="6"><span class="dt">int</span> shiftNumber = intParams[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb71-7" data-line-number="7"><span class="bu">String</span> shiftExpireDateTime = stringParams[<span class="dv">0</span>];</a></code></pre></div>
<h3 id="запрос-статуса">1036 - запрос статуса</h3>
<p>Тип <code>object</code> - <strong>String[10]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - флаг фискальности ККТ</li>
<li><code>data[1]</code> - флаг фискальности ФН</li>
<li><code>data[2]</code> - флаг наличия ФН</li>
<li><code>data[3]</code> - состояние смены (0 - закрыта, 1 - открыта, 2 - истекла)</li>
<li><code>data[4]</code> - денежный ящик открыт/закрыт. На значение влияет настройка <strong>invertCashDrawerStatus</strong>.</li>
<li><code>data[5]</code> - флаг наличия бумаги</li>
<li><code>data[6]</code> - крышка открыта/закрыта</li>
<li><code>data[7]</code> - флаг блокировки ККТ из-за фатальной ошибки</li>
<li><code>data[8]</code> - флаг ошибки отрезчика</li>
<li><code>data[9]</code> - флаг перегрева печатной головки</li>
<li><code>object[0]</code> - текущие дата и время ККТ (формат - <em>ddMMyyyyHHmmss</em>)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="dt">int</span>[] intParams = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">10</span>];</a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="bu">String</span>[] stringParams = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1036</span>, intParams, stringParams);</a></code></pre></div>
<h3 id="запись-кода-обуви">1037 - запись кода обуви</h3>
<blockquote>
<p><strong>ВАЖНО</strong>: С помощью этого directIO можно сформировать код обуви ТОЛЬКО старого образца. Рекомендуется использовать directIO #1040 или directIO #1039.</p>
</blockquote>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификтор продукта GTIN;</li>
<li><code>object[1]</code> - серийный номер.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="bu">String</span> gtin = <span class="st">&quot;98765432101234&quot;</span>;</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="bu">String</span> serial = <span class="st">&quot;sgEKKPPcS25y5&quot;</span>;</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"></a>
<a class="sourceLine" id="cb73-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1037</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{gtin, serial});</a></code></pre></div>
<p>Выполнять операцию нужно непосредственно перед регистрацией позиции, к которой код товара относится.</p>
<h3 id="установка-имени-кассира">1038 - установка имени кассира</h3>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - имя кассира.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="bu">String</span> operatorName = <span class="st">&quot;Иванов И.И.&quot;</span>;</a>
<a class="sourceLine" id="cb74-2" data-line-number="2"></a>
<a class="sourceLine" id="cb74-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1038</span>, <span class="kw">null</span>, operatorName);</a></code></pre></div>
<h3 id="запись-сырого-кода-маркировки">1039 - запись “сырого” кода маркировки</h3>
<p>Позволяет передать в ККТ расчитанное пользователем драйвера значение реквизита 1162.</p>
<p>Тип <code>object</code> - <strong>Byte[]</strong> или <strong>byte[]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - значение реквизита.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="dt">byte</span>[] markingCode = <span class="kw">new</span> <span class="bu">Byte</span>[]{<span class="bn">0x01</span>, <span class="bn">0x02</span>, <span class="bn">0x03</span>};</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"></a>
<a class="sourceLine" id="cb75-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1039</span>, <span class="kw">null</span>, markingCode);</a></code></pre></div>
<h3 id="запись-неразобранной-марки">1040 - запись неразобранной марки</h3>
<p>Позволяет передать в ККТ значение считанной сканером марки, которое будет средствами ККТ преобразовано в реквизит 1162.</p>
<p>Тип <code>object</code> - <strong>Byte[]</strong> или <strong>byte[]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - тип марки:
<ul>
<li><strong>0 (или data == null)</strong> - другой КТ</li>
<li><strong>1</strong> - ЕГАИС 2.0</li>
<li><strong>2</strong> - ЕГАИС 3.0</li>
</ul></li>
<li><code>object</code> - значение марки.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="dt">int</span>[] markingType = {<span class="dv">1</span>};</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="dt">byte</span>[] markingCode = &lt;данные марки&gt;;</a>
<a class="sourceLine" id="cb76-3" data-line-number="3"></a>
<a class="sourceLine" id="cb76-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1040</span>, markingType, markingCode);</a></code></pre></div>
<h3 id="добавление-текста-для-печати-рядом-со-штрихкодом">1041 - добавление текста для печати рядом со штрихкодом</h3>
<p>Позволяет добавить текст с форматированием к ШК, печатаемому с помощью directIO #1002.. Драйвер не отвечает за выравнивание текста относительно ШК, расчёт расположения текста должен производить управляющий софт.</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - выравнивание
<ul>
<li><strong>0</strong> - слева</li>
<li><strong>1</strong> - по центру</li>
<li><strong>2</strong> - справа</li>
</ul></li>
<li><code>data[1]</code> - двойная ширина</li>
<li><code>data[2]</code> - двойная высота</li>
<li><code>data[3]</code> - зарезервировано</li>
<li><code>data[4]</code> - шрифт</li>
<li><code>object</code> - текст</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="dt">int</span> strAlignment = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="bu">String</span> text = <span class="st">&quot;Строка %d&quot;</span>;</a>
<a class="sourceLine" id="cb77-3" data-line-number="3"></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">8</span>; ++i) {</a>
<a class="sourceLine" id="cb77-5" data-line-number="5">    fptr.<span class="fu">directIO</span>(<span class="dv">1041</span>, <span class="kw">new</span> <span class="dt">int</span>[]{strAlignment}, <span class="bu">String</span><span class="fu">.format</span>(text, i+<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb77-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb77-7" data-line-number="7"></a>
<a class="sourceLine" id="cb77-8" data-line-number="8"><span class="dt">int</span> barcodeType = <span class="dv">11</span>;</a>
<a class="sourceLine" id="cb77-9" data-line-number="9"><span class="dt">int</span> barcodeScale = <span class="dv">7</span>;</a>
<a class="sourceLine" id="cb77-10" data-line-number="10"><span class="dt">int</span> barcodeHeight = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb77-11" data-line-number="11"><span class="dt">int</span> barcodePrintText = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb77-12" data-line-number="12"><span class="dt">int</span> barcodeAlignment = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb77-13" data-line-number="13">fptr.<span class="fu">directIO</span>(<span class="dv">1002</span>, <span class="kw">new</span> <span class="dt">int</span>[]{barcodeType, barcodeScale, barcodeHeight, barcodePrintText, barcodeAlignment}, <span class="st">&quot;ДАННЫЕ ШК&quot;</span>);</a></code></pre></div>
<h3 id="запрос-версии-шаблонов">1042 - запрос версии шаблонов</h3>
<p>Позволяет запросить информацию о загруженных в ККТ версий 5.X шаблонах.</p>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - название шаблонов</li>
<li><code>object[1]</code> - хеш шаблонов</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="bu">String</span>[] templatesInfo = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1042</span>, <span class="kw">null</span>, templatesInfo);</a></code></pre></div>
<h3 id="загрузка-контейнера">1043 - загрузка контейнера</h3>
<p>Позволяет загрузить контейнер в ККТ, в т.ч. с шаблонами.</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - путь к файлу контейнера</li>
</ul>
<p>Выходные параметры: Нет</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb79-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1043</span>, <span class="kw">null</span>, <span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">containter.con&quot;</span>);</a></code></pre></div>
<h3 id="загрузка-шаблонов">1044 - загрузка шаблонов</h3>
<p>Позволяет загрузить в ККТ шаблоны</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - путь к файлу шаблонов</li>
</ul>
<p>Выходные параметры: Нет</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb80-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1044</span>, <span class="kw">null</span>, <span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">templates.bin&quot;</span>);</a></code></pre></div>
<h3 id="загрузка-лицензий">1045 - загрузка лицензий</h3>
<p>Позволяет загрузить в ККТ лицензии</p>
<p>Тип <code>object</code> - <strong>String[]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - список лицензий</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[i]</code> - результат записи i-ой лицензии. Будет заполняться только в случае, если элемент массива доступен.</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="bu">String</span>[] licenses = <span class="kw">new</span> <span class="bu">String</span>[]{<span class="st">&quot;&lt;тело лицензии&gt;&quot;</span>};</a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="dt">int</span>[] results = <span class="kw">new</span> <span class="dt">int</span>[licenses.<span class="fu">length</span>];</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1045</span>, results, licenses);</a></code></pre></div>
<h3 id="загрузка-лицензий-из-файла">1046 - загрузка лицензий из файла</h3>
<p>Позволяет загрузить в ККТ лицензии из файла</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - путь к файлу</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - количество успешно записанных лицензий.</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="bu">String</span> filePath = <span class="st">&quot;путь к файлу лицензии&quot;</span>;</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb82-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1046</span>, result, filePath);</a></code></pre></div>
<h3 id="загрузка-лицензий-из-данных-файла">1047 - загрузка лицензий из данных файла</h3>
<p>Позволяет загрузить в ККТ лицензии из заранеее считанного файла. Ожидаются данные в кодировке UTF-8.</p>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object</code> - данные файла</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - количество успешно записанных лицензий.</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="bu">String</span> fileData = <span class="st">&quot;данные считанного файла&quot;</span>;</a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1047</span>, result, fileData);</a></code></pre></div>
<h3 id="считывание-лицензий">1048 - считывание лицензий</h3>
<p>Позволяет считатать из ККТ параметры записанных лицензий.</p>
<p>Тип <code>object</code> - <strong>String[1]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - json с информацией о лицензиях. Представляет из себя массив с объектами, описывающими лицензии. Поля json:
<ul>
<li><code>number</code> - номер лицензии</li>
<li><code>name</code> - название лицензии</li>
<li><code>validFrom</code> - дата начала действия лицензии. Формат - <em>ddMMyyyy</em></li>
<li><code>validTo</code> - дата окончания действия лицензии. Формат - <em>ddMMyyyy</em></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="bu">String</span>[] licenses = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1048</span>, <span class="kw">null</span>, licenses);</a></code></pre></div>
<p>Пример json:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb85-1" data-line-number="1">[</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Фискальные функции&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-7" data-line-number="7">   <span class="op">},</span></a>
<a class="sourceLine" id="cb85-8" data-line-number="8">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-9" data-line-number="9">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Запись ПО ККТ&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-12" data-line-number="12">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-13" data-line-number="13">   <span class="op">},</span></a>
<a class="sourceLine" id="cb85-14" data-line-number="14">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-15" data-line-number="15">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Работа с НДС 20%&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-16" data-line-number="16">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">3</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-17" data-line-number="17">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-18" data-line-number="18">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-19" data-line-number="19">   <span class="op">},</span></a>
<a class="sourceLine" id="cb85-20" data-line-number="20">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-21" data-line-number="21">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Обработка маркировки&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-22" data-line-number="22">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">5</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-23" data-line-number="23">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-24" data-line-number="24">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-25" data-line-number="25">   <span class="op">},</span></a>
<a class="sourceLine" id="cb85-26" data-line-number="26">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-27" data-line-number="27">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Расширенная функциональность&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-28" data-line-number="28">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">6</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-29" data-line-number="29">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-30" data-line-number="30">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-31" data-line-number="31">   <span class="op">},</span></a>
<a class="sourceLine" id="cb85-32" data-line-number="32">   <span class="op">{</span></a>
<a class="sourceLine" id="cb85-33" data-line-number="33">      <span class="st">&quot;name&quot;</span> <span class="op">:</span> <span class="st">&quot;Работа с ФФД 1.1&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-34" data-line-number="34">      <span class="st">&quot;number&quot;</span> <span class="op">:</span> <span class="dv">4</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-35" data-line-number="35">      <span class="st">&quot;validFrom&quot;</span> <span class="op">:</span> <span class="st">&quot;01012018&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb85-36" data-line-number="36">      <span class="st">&quot;validUntil&quot;</span> <span class="op">:</span> <span class="st">&quot;31122025&quot;</span></a>
<a class="sourceLine" id="cb85-37" data-line-number="37">   <span class="op">}</span></a>
<a class="sourceLine" id="cb85-38" data-line-number="38">]</a></code></pre></div>
<h3 id="запись-неразобранной-марки-ффд-1.2-в-позицию-чека">1049 - запись неразобранной марки (ФФД 1.2) в позицию чека</h3>
<p>Позволяет передать значение считанной сканером марки в ККТ, работающую по ФФД 1.2 или выше. Метод передаёт уже проверенную марку в позицию чека. Марка предварительно проверяется с помощью DirectIO 1050..1053 или DirectIO 1058..1061.</p>
<p>Тип <code>object</code> - <strong>Object[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - тип марки (тег 2100):
<ul>
<li><strong>0</strong> - тип кода маркировки не идентифицирован,</li>
<li><strong>1</strong> - короткий код маркировки,</li>
<li><strong>2</strong> - код маркировки со значением кода проверки длиной 88 символов, подлежащим проверке в ФН,</li>
<li><strong>3</strong> - код маркировки со значением кода проверки длиной 44 символа, не подлежащим проверке в ФН,</li>
<li><strong>4</strong> - код маркировки со значением кода проверки длиной 44 символа, подлежащим проверке в ФН,</li>
<li><strong>5</strong> - код маркировки со значением кода проверки длиной 4 символа, не подлежащим проверке в ФН,</li>
<li><strong>256</strong> - драйвер попытается определить тип автоматически.</li>
</ul></li>
<li><code>data[1]</code> - присвоенный статус товара (тег 2110)</li>
<li><code>data[2]</code> - режим обработки КМ (тег 2102)</li>
<li><p><code>data[3]</code> - результат проверки сведений о товаре, битовое поле (тег 2106)</p></li>
<li><code>((Object[]) object)[0]</code> - значение марки в виде <strong>Byte[]</strong> или <strong>byte[]</strong> (тег 2000).</li>
<li><p><code>((Object[]) object)[1]</code> - дробное количество товара, строка вида “Ц…Ц/Ц…Ц” или null, если не используется.</p></li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="dt">int</span> markingType = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="dt">byte</span>[] markingCode = {<span class="bn">0x32</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x55</span>, <span class="bn">0x35</span>, <span class="bn">0x44</span>, <span class="bn">0x42</span>, <span class="bn">0x4B</span>, <span class="bn">0x59</span>, <span class="bn">0x44</span>, <span class="bn">0x4F</span>, <span class="bn">0x54</span>, <span class="bn">0x31</span>, <span class="bn">0x37</span>, <span class="bn">0x49</span>, <span class="bn">0x44</span>, <span class="bn">0x39</span>, <span class="bn">0x38</span>, <span class="bn">0x30</span>, <span class="bn">0x37</span>, <span class="bn">0x32</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x38</span>, <span class="bn">0x43</span>, <span class="bn">0x57</span>, <span class="bn">0x31</span>, <span class="bn">0x41</span>, <span class="bn">0x34</span>, <span class="bn">0x58</span>, <span class="bn">0x52</span>, <span class="bn">0x35</span>, <span class="bn">0x45</span>, <span class="bn">0x4A</span>, <span class="bn">0x37</span>, <span class="bn">0x4A</span>, <span class="bn">0x4B</span>, <span class="bn">0x46</span>, <span class="bn">0x58</span>, <span class="bn">0x35</span>, <span class="bn">0x30</span>, <span class="bn">0x46</span>, <span class="bn">0x48</span>, <span class="bn">0x48</span>, <span class="bn">0x47</span>, <span class="bn">0x56</span>, <span class="bn">0x39</span>, <span class="bn">0x32</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x32</span>, <span class="bn">0x47</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x5A</span>};</a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="dt">int</span> markingStatus = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb86-4" data-line-number="4"><span class="dt">int</span> processingMode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="dt">int</span> validationResult = <span class="dv">15</span>;</a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="bu">String</span> fractionalQuantity = <span class="st">&quot;1/2&quot;</span>;</a>
<a class="sourceLine" id="cb86-7" data-line-number="7"></a>
<a class="sourceLine" id="cb86-8" data-line-number="8">fptr.<span class="fu">directIO</span>(<span class="dv">1049</span>, <span class="kw">new</span> <span class="dt">int</span>[]{markingType, markingStatus, processingMode, validationResult}, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, fractionalQuantity});</a></code></pre></div>
<h3 id="очистка-буфера-запросов-на-проверку-марок">1050 - очистка буфера запросов на проверку марок</h3>
<p>Очищает буфер кодов маркировки и сопутствующих параметров, накопленных драйвером для проверки с помощью DirectIO 1051.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb87-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1050</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="добавление-марки-для-проверки">1051 - добавление марки для проверки</h3>
<p>Позволяет передать марку для проверки с помощью ККТ, работающей по ФФД 1.2 или выше. После передачи в драйвер нескольких марок с помощью DirectIO 1051 следует выполнить DirectIO 1052 для выполнения проверки.</p>
<p>Тип <code>object</code> - <strong>Object[7]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>((Object[]) object)[0]</code> - значение марки в виде <strong>Byte[]</strong> или <strong>byte[]</strong> (тег 2000).</li>
<li><code>((Object[]) object)[1]</code> - дробное количество товара, строка вида “Ц…Ц/Ц…Ц” или null, если не используется.</li>
<li><code>((Object[]) object)[2]</code> - тип марки (тег 2100), число:
<ul>
<li><strong>0 (или null)</strong> - тип кода маркировки не идентифицирован,</li>
<li><strong>1</strong> - короткий код маркировки,</li>
<li><strong>2</strong> - код маркировки со значением кода проверки длиной 88 символов, подлежащим проверке в ФН,</li>
<li><strong>3</strong> - код маркировки со значением кода проверки длиной 44 символа, не подлежащим проверке в ФН,</li>
<li><strong>4</strong> - код маркировки со значением кода проверки длиной 44 символа, подлежащим проверке в ФН,</li>
<li><strong>5</strong> - код маркировки со значением кода проверки длиной 4 символа, не подлежащим проверке в ФН,</li>
<li><strong>256</strong> - драйвер попытается определить тип автоматически.</li>
</ul></li>
<li><code>((Object[]) object)[3]</code> - планируемый статус марки (тег 2003), число</li>
<li><code>((Object[]) object)[4]</code> - режим обработки КМ (тег 2102), число</li>
<li><code>((Object[]) object)[5]</code> - количество *1000, аналогично прочим методам UnifiedPOS (тег 1023), число или null, если не используется</li>
<li><code>((Object[]) object)[6]</code> - мера количества предмета расчета (тег 2108), число или null, если не используется</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="dt">int</span> markingType = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="bu">String</span> fractionalQuantity = <span class="st">&quot;1/2&quot;</span>;</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="dt">byte</span>[] markingCode = {<span class="bn">0x32</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x55</span>, <span class="bn">0x35</span>, <span class="bn">0x44</span>, <span class="bn">0x42</span>, <span class="bn">0x4B</span>, <span class="bn">0x59</span>, <span class="bn">0x44</span>, <span class="bn">0x4F</span>, <span class="bn">0x54</span>, <span class="bn">0x31</span>, <span class="bn">0x37</span>, <span class="bn">0x49</span>, <span class="bn">0x44</span>, <span class="bn">0x39</span>, <span class="bn">0x38</span>, <span class="bn">0x30</span>, <span class="bn">0x37</span>, <span class="bn">0x32</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x38</span>, <span class="bn">0x43</span>, <span class="bn">0x57</span>, <span class="bn">0x31</span>, <span class="bn">0x41</span>, <span class="bn">0x34</span>, <span class="bn">0x58</span>, <span class="bn">0x52</span>, <span class="bn">0x35</span>, <span class="bn">0x45</span>, <span class="bn">0x4A</span>, <span class="bn">0x37</span>, <span class="bn">0x4A</span>, <span class="bn">0x4B</span>, <span class="bn">0x46</span>, <span class="bn">0x58</span>, <span class="bn">0x35</span>, <span class="bn">0x30</span>, <span class="bn">0x46</span>, <span class="bn">0x48</span>, <span class="bn">0x48</span>, <span class="bn">0x47</span>, <span class="bn">0x56</span>, <span class="bn">0x39</span>, <span class="bn">0x32</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x32</span>, <span class="bn">0x47</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x5A</span>};</a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="dt">int</span> markingStatus = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="dt">int</span> processingMode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb88-6" data-line-number="6"><span class="dt">int</span> quantity = <span class="dv">2000</span>;</a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="dt">int</span> measurementUnit = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb88-8" data-line-number="8"></a>
<a class="sourceLine" id="cb88-9" data-line-number="9">fptr.<span class="fu">directIO</span>(<span class="dv">1051</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, fractionalQuantity, markingType, markingStatus, processingMode, quantity, measurementUnit});</a></code></pre></div>
<h3 id="проверка-марок">1052 - проверка марок</h3>
<p>Запускает проверку марок, накопленных драйвером в результате вызова DirectIO 1051.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - таймаут в миллисекундах, значение по умолчанию - 60000.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="dt">int</span>[] params = {<span class="dv">90000</span>};</a>
<a class="sourceLine" id="cb89-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1052</span>, params, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="получение-результатов-проверки-марок">1053 - получение результатов проверки марок</h3>
<p>Возвращает результат проверки одного из кодов маркировки. Индекс должен быть в диапазоне от <strong>0</strong> до <strong><количество КМ> - 1</strong>.</p>
<p>Тип <code>object</code> - <strong>String[2]</strong></p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - индекс КМ.</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - Ошибка драйвера</li>
<li><code>data[1]</code> - Ошибка локальной проверки (тег 2004)</li>
<li><code>data[2]</code> - Результат локальной проверки
<ul>
<li><strong>0</strong> - КМ успешно проверен;</li>
<li><strong>1</strong> - КМ данного типа не подлежит проверке в ФН;</li>
<li><strong>2</strong> - ФН не содержит ключи проверки кода проверки этого КМ;</li>
<li><strong>3</strong> - проверка невозможна, так как остутствуют идентификаторы применения GS1 91 и/или 92 или их формат неверный;</li>
<li><strong>4</strong> - проверка невозможна по иной причине;</li>
</ul></li>
<li><code>data[3]</code> - Результат проверки сведений о товаре* (тег 2106)</li>
<li><code>data[4]</code> - Код обработки запроса* (тег 2105)</li>
<li><code>data[5]</code> - Результаты обработки запроса* (тег 2005)</li>
<li><code>data[6]</code> - Сведения о статусе товара* (тег 2109)</li>
<li><code>data[7]</code> - Тип кода маркировки* (тег 2100)</li>
<li><p><code>data[8]</code> - Режим обработки кода товара* (тег 2102)</p></li>
<li><code>object[0]</code> - Идентификатор товара (тег 2101)</li>
<li><p><code>object[1]</code> - Описание ошибки драйвера</p></li>
</ul>
<p>*При отсутствии данных возвращается значение -1.</p>
<p>Пример:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="dt">int</span>[] iArg = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">9</span>];</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="bu">String</span>[] sArg = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb90-3" data-line-number="3"></a>
<a class="sourceLine" id="cb90-4" data-line-number="4">iArg[<span class="dv">0</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb90-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1053</span>, iArg, sArg);</a>
<a class="sourceLine" id="cb90-6" data-line-number="6"></a>
<a class="sourceLine" id="cb90-7" data-line-number="7"><span class="dt">int</span> driverError = iArg[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb90-8" data-line-number="8"><span class="dt">int</span> localValidationError = iArg[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb90-9" data-line-number="9"><span class="dt">int</span> localValidationResult = iArg[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb90-10" data-line-number="10"><span class="dt">int</span> onlineValidationResult = iArg[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb90-11" data-line-number="11"><span class="dt">int</span> requestProcessingCode = iArg[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb90-12" data-line-number="12"><span class="dt">int</span> requestProcessingResult = iArg[<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb90-13" data-line-number="13"><span class="dt">int</span> statusInfo = iArg[<span class="dv">6</span>];</a>
<a class="sourceLine" id="cb90-14" data-line-number="14"><span class="dt">int</span> markingCodeType = iArg[<span class="dv">7</span>];</a>
<a class="sourceLine" id="cb90-15" data-line-number="15"><span class="dt">int</span> processingMode = iArg[<span class="dv">8</span>];</a>
<a class="sourceLine" id="cb90-16" data-line-number="16"></a>
<a class="sourceLine" id="cb90-17" data-line-number="17"><span class="bu">String</span> productID = sArg[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb90-18" data-line-number="18"><span class="bu">String</span> driverErrorDescription = sArg[<span class="dv">1</span>];</a></code></pre></div>
<h3 id="обновление-ключей-фн-м">1054 - обновление ключей ФН-М</h3>
<p>Запускает обновление ключей ФН-М.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb91-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1054</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="передача-отраслевого-реквизита-предмета-расчёта-тег-1260">1055 - передача отраслевого реквизита предмета расчёта (тег 1260)</h3>
<p>Это составной тег по ФФД 1.2, включающий теги 1262, 1263, 1264, 1265.</p>
<p>Тип <code>object</code> - <strong>String[4]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификатор ФОИВ 0 - строка из трёх десятичных цифр согласно ФФД (тег 1262)</li>
<li><code>object[1]</code> - дата нормативного акта федерального органа исполнительной власти, регламентирующего порядок заполнения реквизита (тег 1263) - в формате “ddMMyyyy”<br />
</li>
<li><code>object[2]</code> - номер нормативного акта федерального органа исполнительной власти, регламентирующего порядок заполнения реквизита (тег 1264)</li>
<li><code>object[3]</code> - состав значений, определенных нормативного актом федерального органа исполнительной власти (тег 1265) - строка вида “Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3”</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="bu">String</span> foiv = <span class="st">&quot;010&quot;</span>;</a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="bu">String</span> date = <span class="st">&quot;31122018&quot;</span>;</a>
<a class="sourceLine" id="cb92-3" data-line-number="3"><span class="bu">String</span> num = <span class="st">&quot;12345678901234567890&quot;</span>;</a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="bu">String</span> industryAttr = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>;</a>
<a class="sourceLine" id="cb92-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1055</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv, date, num, industryAttr});             </a></code></pre></div>
<p>Выполнять операцию нужно непосредственно перед регистрацией позиции, к которой относится отраслевой реквизит.</p>
<h3 id="передача-отраслевого-реквизита-чека-тег-1261">1056 - передача отраслевого реквизита чека (тег 1261)</h3>
<p>Это составной тег по ФФД 1.2, включающий теги 1262, 1263, 1264, 1265.</p>
<p>Тип <code>object</code> - <strong>String[4]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>object[0]</code> - идентификатор ФОИВ 0 - строка из трёх десятичных цифр согласно ФФД (тег 1262)</li>
<li><code>object[1]</code> - дата нормативного акта федерального органа исполнительной власти, регламентирующего порядок заполнения реквизита (тег 1263) - в формате “ddMMyyyy”<br />
</li>
<li><code>object[2]</code> - номер нормативного акта федерального органа исполнительной власти, регламентирующего порядок заполнения реквизита (тег 1264)</li>
<li><code>object[3]</code> - состав значений, определенных нормативного актом федерального органа исполнительной власти (тег 1265) - строка вида “Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3”</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="bu">String</span> foiv = <span class="st">&quot;010&quot;</span>;</a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="bu">String</span> date = <span class="st">&quot;31122018&quot;</span>;</a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="bu">String</span> num = <span class="st">&quot;12345678901234567890&quot;</span>;</a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="bu">String</span> industryAttr = <span class="st">&quot;Ид1=Знач1&amp;Ид2=Знач2&amp;Ид3=Знач3&quot;</span>;</a>
<a class="sourceLine" id="cb93-5" data-line-number="5"></a>
<a class="sourceLine" id="cb93-6" data-line-number="6">fptr.<span class="fu">directIO</span>(<span class="dv">1056</span>, <span class="kw">null</span>, <span class="kw">new</span> <span class="bu">String</span>[]{foiv, date, num, industryAttr});             </a></code></pre></div>
<h3 id="передача-дополнительного-операционного-реквизита-чека-тег-1270">1057 - передача дополнительного операционного реквизита чека (тег 1270)</h3>
<p>Это составной тег по ФФД 1.2, включающий теги 1271, 1272, 1273.</p>
<p>Тип <code>object</code> - <strong>String[2]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - идентификатор операции (тег 1271)</li>
<li><code>object[0]</code> - данные операци (тег 1272)</li>
<li><code>object[1]</code> - дата, время операции (тег 1273)</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="dt">int</span> operationId = <span class="dv">7</span>;</a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="bu">String</span> operationData = <span class="st">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="bu">String</span> operationDate = <span class="st">&quot;31122020173621&quot;</span>; <span class="co">//31.12.2020 17:36:21</span></a>
<a class="sourceLine" id="cb94-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1057</span>, <span class="kw">new</span> <span class="dt">int</span>[]{operationId}, <span class="kw">new</span> <span class="bu">String</span>[]{operationData, operationDate});</a></code></pre></div>
<h3 id="начать-проверку-марки">1058 - начать проверку марки</h3>
<p>Позволяет начать проверку марки с помощью ККТ, работающей по ФФД 1.2 или выше.</p>
<p>Тип <code>object</code> - <strong>Object[7]</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>((Object[]) object)[0]</code> - значение марки в виде <strong>Byte[]</strong> или <strong>byte[]</strong> (тег 2000).</li>
<li><code>((Object[]) object)[1]</code> - дробное количество товара, строка вида “Ц…Ц/Ц…Ц” или null, если не используется.</li>
<li><code>((Object[]) object)[2]</code> - тип марки (тег 2100), число:
<ul>
<li><strong>0 (или null)</strong> - тип кода маркировки не идентифицирован,</li>
<li><strong>1</strong> - короткий код маркировки,</li>
<li><strong>2</strong> - код маркировки со значением кода проверки длиной 88 символов, подлежащим проверке в ФН,</li>
<li><strong>3</strong> - код маркировки со значением кода проверки длиной 44 символа, не подлежащим проверке в ФН,</li>
<li><strong>4</strong> - код маркировки со значением кода проверки длиной 44 символа, подлежащим проверке в ФН,</li>
<li><strong>5</strong> - код маркировки со значением кода проверки длиной 4 символа, не подлежащим проверке в ФН,</li>
<li><strong>256</strong> - драйвер попытается определить тип автоматически.</li>
</ul></li>
<li><code>((Object[]) object)[3]</code> - планируемый статус марки (тег 2003), число</li>
<li><code>((Object[]) object)[4]</code> - режим обработки КМ (тег 2102), число</li>
<li><code>((Object[]) object)[5]</code> - количество *1000, аналогично прочим методам UnifiedPOS (тег 1023), число или null, если не используется</li>
<li><code>((Object[]) object)[6]</code> - мера количества предмета расчета (тег 2108), число или null, если не используется</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - Ошибка локальной проверки (тег 2004)</li>
<li><code>data[1]</code> - Результат локальной проверки
<ul>
<li><strong>0</strong> - КМ успешно проверен;</li>
<li><strong>1</strong> - КМ данного типа не подлежит проверке в ФН;</li>
<li><strong>2</strong> - ФН не содержит ключи проверки кода проверки этого КМ;</li>
<li><strong>3</strong> - проверка невозможна, так как остутствуют идентификаторы применения GS1 91 и/или 92 или их формат неверный;</li>
<li><strong>4</strong> - проверка невозможна по иной причине;</li>
</ul></li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="dt">int</span> markingType = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="bu">String</span> fractionalQuantity = <span class="st">&quot;1/2&quot;</span>;</a>
<a class="sourceLine" id="cb95-3" data-line-number="3"><span class="dt">byte</span>[] markingCode = {<span class="bn">0x32</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x30</span>, <span class="bn">0x32</span>, <span class="bn">0x4E</span>, <span class="bn">0x55</span>, <span class="bn">0x35</span>, <span class="bn">0x44</span>, <span class="bn">0x42</span>, <span class="bn">0x4B</span>, <span class="bn">0x59</span>, <span class="bn">0x44</span>, <span class="bn">0x4F</span>, <span class="bn">0x54</span>, <span class="bn">0x31</span>, <span class="bn">0x37</span>, <span class="bn">0x49</span>, <span class="bn">0x44</span>, <span class="bn">0x39</span>, <span class="bn">0x38</span>, <span class="bn">0x30</span>, <span class="bn">0x37</span>, <span class="bn">0x32</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x30</span>, <span class="bn">0x31</span>, <span class="bn">0x39</span>, <span class="bn">0x36</span>, <span class="bn">0x30</span>, <span class="bn">0x38</span>, <span class="bn">0x43</span>, <span class="bn">0x57</span>, <span class="bn">0x31</span>, <span class="bn">0x41</span>, <span class="bn">0x34</span>, <span class="bn">0x58</span>, <span class="bn">0x52</span>, <span class="bn">0x35</span>, <span class="bn">0x45</span>, <span class="bn">0x4A</span>, <span class="bn">0x37</span>, <span class="bn">0x4A</span>, <span class="bn">0x4B</span>, <span class="bn">0x46</span>, <span class="bn">0x58</span>, <span class="bn">0x35</span>, <span class="bn">0x30</span>, <span class="bn">0x46</span>, <span class="bn">0x48</span>, <span class="bn">0x48</span>, <span class="bn">0x47</span>, <span class="bn">0x56</span>, <span class="bn">0x39</span>, <span class="bn">0x32</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x32</span>, <span class="bn">0x47</span>, <span class="bn">0x5A</span>, <span class="bn">0x52</span>, <span class="bn">0x5A</span>};</a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="dt">int</span> markingStatus = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb95-5" data-line-number="5"><span class="dt">int</span> processingMode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb95-6" data-line-number="6"><span class="dt">int</span> quantity = <span class="dv">2000</span>;</a>
<a class="sourceLine" id="cb95-7" data-line-number="7"><span class="dt">int</span> measurementUnit = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb95-8" data-line-number="8"><span class="dt">int</span> waitForResult = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb95-9" data-line-number="9"></a>
<a class="sourceLine" id="cb95-10" data-line-number="10"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb95-11" data-line-number="11">fptr.<span class="fu">directIO</span>(<span class="dv">1058</span>, result, <span class="kw">new</span> <span class="bu">Object</span>[] {markingCode, fractionalQuantity, markingType, markingStatus, processingMode, quantity, measurementUnit, waitForResult});</a></code></pre></div>
<h3 id="результат-проверки-марки">1059 - результат проверки марки</h3>
<p>Тип <code>object</code> - <strong>Object[8]</strong>.</p>
<p>Необходимо ожидать ответа, периодически запрашивая результат проверки марки до тех пор, пока результат проверки не будет равен 1.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - проверка завершена (1 - завершена, 0 - не завершена)<br />
Параметры ниже актуальны только если проверка завершена!</li>
<li><code>object[0]</code> - результат проверки сведений о товаре (тег 2106), число</li>
<li><code>object[1]</code> - ошибка онлайн проверки, число</li>
<li><code>object[2]</code> - сведения о статусе товара (тег 2109); число или null, если отсутствует</li>
<li><code>object[3]</code> - результат обработки запроса (тег 2005); число или null, если отсутствует</li>
<li><code>object[4]</code> - код обработки запроса (тег 2105), число</li>
<li><code>object[5]</code> - тип кода маркировки (тег 2100); число или null, если отсутствует</li>
<li><code>object[6]</code> - режим обработки кода маркировки (тег 2102); число или null, если отсутствует</li>
<li><code>object[7]</code> - идентификатор товара (тег 2101), строка</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="dt">int</span>[] ready = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="bu">Object</span>[] result = <span class="kw">new</span> <span class="bu">Object</span>[<span class="dv">8</span>];</a>
<a class="sourceLine" id="cb96-3" data-line-number="3"></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="kw">while</span> (<span class="kw">true</span>) {</a>
<a class="sourceLine" id="cb96-5" data-line-number="5">    fptr.<span class="fu">directIO</span>(<span class="dv">1059</span>, ready, result);</a>
<a class="sourceLine" id="cb96-6" data-line-number="6">    <span class="kw">if</span> (ready[<span class="dv">0</span>] == <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb96-7" data-line-number="7">        <span class="kw">break</span>;</a>
<a class="sourceLine" id="cb96-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb96-9" data-line-number="9"></a>
<a class="sourceLine" id="cb96-10" data-line-number="10"><span class="dt">long</span> validationResult = (<span class="dt">long</span>)((<span class="bu">Object</span>[]) result)[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb96-11" data-line-number="11">...</a></code></pre></div>
<h3 id="прерывание-проверки-марки">1060 - прерывание проверки марки</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb97-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1060</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="подтверждение-реализации-маркированного-товара">1061 - подтверждение реализации маркированного товара</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - результат проверки сведений о товаре (тег 2106)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb98-2" data-line-number="2"></a>
<a class="sourceLine" id="cb98-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1061</span>, result, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="отказ-от-реализации-маркированного-товара">1062 - отказ от реализации маркированного товара</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb99-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1062</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="очистка-буфера-проверки-марок-в-фн">1063 - очистка буфера проверки марок в ФН</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb100-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1063</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="добавление-кода-товара">1064 - добавление кода товара</h3>
<p>Выполняется только при открытом чеке. Вызывать нужно <em>ДО</em> регистрации позиции, к которой реквизиты должны быть применены. Для добавления кода товара необходимо подать тип кода товара и его значение в строковом представлении.</p>
<ul>
<li>Коды товара типа 1-16 допускается подавать не более одного раза.</li>
<li>Коды товара типа 0 допускается подавать многократо.</li>
<li>Недопустимо в одной позиции смешивать типы 0 и 1-16, т.е. либо все коды товара с автоматически определяемым типом, либо все коды товара с указанием конкретного типа товара (1-16).</li>
</ul>
<p>Тип <code>object</code> - <strong>String</strong>.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - номер реквизита. Возможные значения:
<ul>
<li>0 - определить тип кода товара автоматически;</li>
<li>1 - нераспозанный код товара (тег 1300);<br />
</li>
<li>2 - КТ EAN-8 (тег 1301);<br />
</li>
<li>3 - КТ EAN-13 (тег 1302);<br />
</li>
<li>4 - КТ ITF-14 (тег 1303);<br />
</li>
<li>5 - КТ GS1.0 (тег 1304);<br />
</li>
<li>6 - КТ GS1.M (тег 1305);<br />
</li>
<li>7 - КТ КМК (короткий маркировочный код) (тег 1306);</li>
<li>8 - КТ МИ (меховые изделия) (тег 1307);<br />
</li>
<li>9 - КТ ЕГАИС-2.0 (тег 1308);<br />
</li>
<li>10 - КТ ЕГАИС-3.0 (тег 1309);<br />
</li>
<li>11 - КТ Ф.1 (тег 1320);<br />
</li>
<li>12 - КТ Ф.2 (тег 1321);<br />
</li>
<li>13 - КТ Ф.3 (тег 1322);<br />
</li>
<li>14 - КТ Ф.4 (тег 1323);<br />
</li>
<li>15 - КТ Ф.5 (тег 1324);<br />
</li>
<li>16 - КТ Ф.6 (тег 1325);</li>
</ul></li>
<li><code>object</code> - значение реквизита.</li>
</ul>
<p>Выходные параметры: Нет</p>
<p>Пример добавления кодов товара с автоматическим определением типа:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="dt">int</span> typeCode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="bu">String</span>[] productCodes = <span class="kw">new</span> <span class="bu">String</span>[]{</a>
<a class="sourceLine" id="cb101-3" data-line-number="3">    <span class="st">&quot;1234567X&quot;</span>,</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">    <span class="st">&quot;123456789012X&quot;</span>,</a>
<a class="sourceLine" id="cb101-5" data-line-number="5">    <span class="st">&quot;sgEKKPPcS25y5&quot;</span>,</a>
<a class="sourceLine" id="cb101-6" data-line-number="6">    ...</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">};</a>
<a class="sourceLine" id="cb101-8" data-line-number="8"></a>
<a class="sourceLine" id="cb101-9" data-line-number="9"><span class="kw">for</span> (<span class="bu">String</span> productCode : productCodes) {</a>
<a class="sourceLine" id="cb101-10" data-line-number="10">    fptr.<span class="fu">directIO</span>(<span class="dv">1064</span>, <span class="kw">new</span> <span class="dt">int</span>[]{typeCode}, productCode);</a>
<a class="sourceLine" id="cb101-11" data-line-number="11">}</a></code></pre></div>
<p>Пример добавления кодов товара с указанием типа товара:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="dt">int</span> typeCode = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="bu">String</span> productCode = <span class="st">&quot;123456789012X&quot;</span>;</a>
<a class="sourceLine" id="cb102-3" data-line-number="3"></a>
<a class="sourceLine" id="cb102-4" data-line-number="4">fptr.<span class="fu">directIO</span>(<span class="dv">1064</span>, <span class="kw">new</span> <span class="dt">int</span>[]{typeCode}, productCode);</a></code></pre></div>
<h3 id="запрос-состояния-работы-с-км">1065 - запрос состояния работы с КМ</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - состояние проверки КМ, может принимать следующие значения:
<ul>
<li>0 - работа с КМ временно заблокирована (переполнение области уведомлений);</li>
<li>1 - нет КМ на проверке;</li>
<li>2 - передан КМ в команде B1h;</li>
<li>3 - сформирован запрос о статусе КМ в команде B5h;</li>
<li>4 - получен ответ на запрос о статусе КМ в команде B6h</li>
</ul></li>
<li><code>data[1]</code> - количество проверок КМ;</li>
<li><code>data[2]</code> - количество реализованных КМ;</li>
<li><code>data[3]</code> - формирование уведомления, может принимать следующие значения:
<ul>
<li>0 - уведомление не формируется;</li>
<li>1 - формирование уведомления начато;</li>
</ul></li>
<li><code>data[4]</code> - ресурс области уведомлений, может принимать следующие значения:
<ul>
<li>0 - область заполнена менее чем на 50%;</li>
<li>1 - область заполнена от 50 до 80%;</li>
<li>2 - область заполнена от 80 до 90%;</li>
<li>3 - область заполнена более чем на 90%;</li>
</ul></li>
<li><code>data[5]</code> - количество уведомлений в очереди;</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">6</span>];</a>
<a class="sourceLine" id="cb103-2" data-line-number="2"></a>
<a class="sourceLine" id="cb103-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1065</span>, result, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb103-4" data-line-number="4"></a>
<a class="sourceLine" id="cb103-5" data-line-number="5"><span class="dt">int</span> markingModeCheckingStatus = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb103-6" data-line-number="6"><span class="dt">int</span> markCheckingCount = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb103-7" data-line-number="7"><span class="dt">int</span> markSoldCount = result[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb103-8" data-line-number="8"><span class="dt">boolean</span> noticeIsBegin = (result[<span class="dv">3</span>] == <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb103-9" data-line-number="9"><span class="dt">int</span> noticeFreeMemory = result[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb103-10" data-line-number="10"><span class="dt">int</span> noticeCount = result[<span class="dv">5</span>];</a></code></pre></div>
<h3 id="запрос-состояния-очереди-отправки">1066 - запрос состояния очереди отправки</h3>
<p>Данный запрос проверяет состояние буффера КМ драйвера. Запрос актуален только при проверке КМ без ожидания ответа от сервера (марка предварительно отправляется на проверку вызовом DirectIO #1058 с настройкой <code>object[7]</code> = “1”) и с настройкой драйвера “validateMarksWithFnmOnly” = “1”.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - признак завершения фоновых проверок
<ul>
<li>0 - проверка не завершена</li>
<li>1 - проверка завершена</li>
</ul></li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1066</span>, result, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="проверка-связи-с-сервером-исм">1067 - проверка связи с сервером ИСМ</h3>
<p>Тип <code>object</code> - <strong>Object[4]</strong>.</p>
<p>Данный запрос позволяет проверить связь с сервером ИСМ.</p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - этап проверки. Возможные значения:
<ul>
<li>0 - начать проверку сервера ИСМ;</li>
<li>1 - получить результаты проверки сервера ИСМ;</li>
</ul></li>
</ul>
<p>Выходные параметры (только для этапа 1 - получение результатов проверки сервера ИСМ):</p>
<ul>
<li><code>object[0]</code> - признак завершения проверки связи, число
<ul>
<li>0 - проверка не завершена</li>
<li>1 - проверка завершена Параметры ниже актуальны только если проверка завершена! Иначе параметры ниже имеют значение null.</li>
</ul></li>
<li><code>object[1]</code> - ошибка проверки, число, соответствующее коду ошибки драйвера</li>
<li><code>object[2]</code> - описание ошибки проверки, строка</li>
<li><code>object[3]</code> - время ожидания ответа от сервера (в мс), число</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="dt">int</span> mode = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb105-2" data-line-number="2">fptr.<span class="fu">directIO</span>(<span class="dv">1067</span>, <span class="kw">new</span> <span class="dt">int</span>[]{mode}, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb105-3" data-line-number="3"></a>
<a class="sourceLine" id="cb105-4" data-line-number="4">mode = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="bu">Object</span>[] result = <span class="kw">new</span> <span class="bu">Object</span>[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb105-6" data-line-number="6"></a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="kw">while</span> (<span class="kw">true</span>) {</a>
<a class="sourceLine" id="cb105-8" data-line-number="8">    fptr.<span class="fu">directIO</span>(<span class="dv">1067</span>, <span class="kw">new</span> <span class="dt">int</span>[]{mode}, result);</a>
<a class="sourceLine" id="cb105-9" data-line-number="9">    <span class="kw">if</span> ((<span class="dt">int</span>)((<span class="bu">Object</span>[]) result)[<span class="dv">0</span>] == <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb105-10" data-line-number="10">        <span class="kw">break</span>;</a>
<a class="sourceLine" id="cb105-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb105-12" data-line-number="12"></a>
<a class="sourceLine" id="cb105-13" data-line-number="13"><span class="dt">int</span> error = (<span class="dt">int</span>)((<span class="bu">Object</span>[]) result)[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb105-14" data-line-number="14"><span class="bu">String</span> description = (<span class="bu">String</span>)((<span class="bu">Object</span>[]) result)[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb105-15" data-line-number="15"><span class="dt">int</span> waitTimeout = (<span class="dt">int</span>)((<span class="bu">Object</span>[]) result)[<span class="dv">3</span>];</a></code></pre></div>
<h3 id="запрос-статуса-обмена-с-исм">1068 - запрос статуса обмена с ИСМ</h3>
<p>Тип <code>object</code> - <strong>String[3]</strong>.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>object[0]</code> - количество неотправленных уведомлений</li>
<li><code>object[1]</code> - номер первого неотправленного уведомления</li>
<li><code>object[2]</code> - дата и время первого неотправленного уведомления (формат - <em>ddMMyyyyHHmm</em>) или null, если неотправленных уведомлений нет</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="bu">String</span>[] result = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"></a>
<a class="sourceLine" id="cb106-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1068</span>, <span class="kw">null</span>, result);</a>
<a class="sourceLine" id="cb106-4" data-line-number="4"><span class="bu">String</span> noticeCount = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb106-5" data-line-number="5"><span class="bu">String</span> noticeNumber = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb106-6" data-line-number="6"><span class="bu">String</span> noticeDateTime = result[<span class="dv">2</span>];</a></code></pre></div>
<h3 id="запрос-ресурса-отрезчика-и-тпг">1069 - запрос ресурса отрезчика и ТПГ</h3>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - количество отрезов, ресурс отрезчика (постоянный)</li>
<li><code>data[1]</code> - количество отрезов, ресурс отрезчика (сбрасываемый при тех.обнулении)</li>
<li><code>data[2]</code> - ресурс ТПГ (постоянный)</li>
<li><code>data[3]</code> - ресурс ТПГ (сбрасываемый при тех.обнулении)</li>
<li><code>data[4]</code> - температура ТПГ (градусы Цельсия)</li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb107-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb107-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1069</span>, result, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="dt">int</span> constCutCount = result[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="dt">int</span> resetCutCount = result[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb107-6" data-line-number="6"><span class="dt">int</span> constPrintheadResource = result[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb107-7" data-line-number="7"><span class="dt">int</span> resetPrintheadResource = result[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb107-8" data-line-number="8"><span class="dt">int</span> printheadTemperature = result[<span class="dv">4</span>];</a></code></pre></div>
<h3 id="запрос-признака-некорректных-кодов-маркировки">1070 - запрос признака некорректных кодов маркировки</h3>
<p>Данный запрос следует подавать сразу же после закрытия смены до открытия следующего фискального документа, т.е. последний фискальный документ в ФН должен являться отчётом о закрытии смены. Все признаки актуальны для тех КМ, с которыми происходила работа в течение смены или между сменами. Данный запрос возвращает данные реквизита 2112 (согласно ФФД 1.2).</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - признак ответа на запрос КМ, содержащий сведения о некорректном КМ (соответствует биту 1 реквизита 2112 по ФФД 1.2)
<ul>
<li>0 - отсутствуют ответы на запросы, содержащий сведения о некорректном КМ</li>
<li>1 - поступил ответ на запрос, содержащий сведения о некорректном КМ</li>
</ul></li>
<li><code>data[1]</code> - признак квитанции на уведомление, содержащий сведения о некорректном КМ (соответствует биту 2 реквизита 2112 по ФФД 1.2)
<ul>
<li>0 - в течение смены или между сменами выявлены недостоверные КМ</li>
<li>1 - поступила квитанция на уведомление, содержащая сведения о некорректном КМ</li>
</ul></li>
</ul>
<p>Пример:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="dt">int</span>[] result = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb108-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb108-3" data-line-number="3">fptr.<span class="fu">directIO</span>(<span class="dv">1070</span>, result, <span class="kw">null</span>);</a>
<a class="sourceLine" id="cb108-4" data-line-number="4"></a>
<a class="sourceLine" id="cb108-5" data-line-number="5"><span class="dt">boolean</span> responseToRequestUnreliableMarkingCodes = (result[<span class="dv">0</span>] == <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb108-6" data-line-number="6"><span class="dt">boolean</span> responseToNoticeUnreliableMarkingCodes = (result[<span class="dv">1</span>] == <span class="dv">1</span>);</a></code></pre></div>
<h3 id="добавление-марок-в-таблицу-проверенных-км">1071 - добавление марок в таблицу проверенных КМ</h3>
<p>Запускает добавление марок в таблицу проверенных КМ, накопленных драйвером в результате вызова DirectIO 1051.</p>
<p>Входные параметры: Нет</p>
<p>Выходные параметры: Нет</p>
<p>Пример:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb109-1" data-line-number="1">fptr.<span class="fu">directIO</span>(<span class="dv">1071</span>, <span class="kw">null</span>, <span class="kw">null</span>);</a></code></pre></div>
<h3 id="получение-результатов-добавления-марок-в-таблицу-проверенных-км">1072 - получение результатов добавления марок в таблицу проверенных КМ</h3>
<p>Возвращает результат добавления марок в таблицу проверенных КМ одного из кодов маркировки. Индекс должен быть в диапазоне от <strong>0</strong> до <strong><количество КМ> - 1</strong>.</p>
<p>Тип <code>object</code> - <strong>String[1]</strong></p>
<p>Входные параметры:</p>
<ul>
<li><code>data[0]</code> - индекс КМ.</li>
</ul>
<p>Выходные параметры:</p>
<ul>
<li><code>data[0]</code> - Ошибка драйвера</li>
<li><code>data[1]</code> - Ошибка локальной проверки (тег 2004)</li>
<li><code>data[2]</code> - Результат локальной проверки
<ul>
<li><strong>0</strong> - КМ успешно проверен;</li>
<li><strong>1</strong> - КМ данного типа не подлежит проверке в ФН;</li>
<li><strong>2</strong> - ФН не содержит ключи проверки кода проверки этого КМ;</li>
<li><strong>3</strong> - проверка невозможна, так как остутствуют идентификаторы применения GS1 91 и/или 92 или их формат неверный;</li>
<li><strong>4</strong> - проверка невозможна по иной причине;</li>
</ul></li>
<li><p><code>data[3]</code> - Результат проверки сведений о товаре* (тег 2106)</p></li>
<li><p><code>object[0]</code> - Описание ошибки драйвера</p></li>
</ul>
<p>*При отсутствии данных возвращается значение -1.</p>
<p>Пример:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="dt">int</span>[] iArg = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">4</span>];</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="bu">String</span>[] sArg = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb110-3" data-line-number="3"></a>
<a class="sourceLine" id="cb110-4" data-line-number="4">iArg[<span class="dv">0</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb110-5" data-line-number="5">fptr.<span class="fu">directIO</span>(<span class="dv">1072</span>, iArg, sArg);</a>
<a class="sourceLine" id="cb110-6" data-line-number="6"></a>
<a class="sourceLine" id="cb110-7" data-line-number="7"><span class="dt">int</span> driverError = iArg[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb110-8" data-line-number="8"><span class="dt">int</span> localValidationError = iArg[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb110-9" data-line-number="9"><span class="dt">int</span> localValidationResult = iArg[<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb110-10" data-line-number="10"><span class="dt">int</span> onlineValidationResult = iArg[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb110-11" data-line-number="11"></a>
<a class="sourceLine" id="cb110-12" data-line-number="12"><span class="bu">String</span> driverErrorDescription = sArg[<span class="dv">0</span>];</a></code></pre></div>
<h2 id="программирование-ккт">Программирование ККТ</h2>
<h3 id="настройка-клише">Настройка клише</h3>
<p>Драйвер использует следующий механизм по загрузке клише в ККТ:</p>
<ol type="1">
<li>При подключении к ККТ драйвер синхронизирует загруженные в ККТ картинки с теми, которые указаны в файле из настройки <strong>picturesFileName</strong>. Для ККТ версий 5.X в клише запишется только первая картинка из файла, остальные будут проигнорированы.</li>
<li>В ККТ записываются параметры клише из настроек <strong>numHeaderLines</strong> и <strong>numTrailerLines</strong>.</li>
<li>Сами строки клише загружаются через стандартные методы <strong>setHeaderLine()</strong> и <strong>setTrailerLine()</strong>. Индексы строк не должны превышать значения настроек <strong>numHeaderLines</strong> и <strong>numTrailerLines</strong> соответственно.</li>
<li>При загрузке обрабатывается каждая строка на предмет наличия подстроки <strong>clichePicturePrefix</strong> в ней. Если подстрока найдена, то все остальные данные удаляются, а найденная подстрока преобразуется в формат, пригодный для ККТ.</li>
<li>Строка записывается в настройки ККТ.</li>
</ol>
<h3 id="загрузка-настроек-в-ккт">Загрузка настроек в ККТ</h3>
<p>Для автоматической загрузки настроек в ККТ служит CSV-файл с описанием настроек, имя которого задается в настройках драйвера параметром <strong>parametersFileName</strong>. Если параметр имеет пустое значение, загрузка не выполняется. Всего 3 поля - номер параметра, название и значение, разделенные запятой. Кодировка - <strong>UTF-8</strong>.</p>
<p>Например:</p>
<pre class="csv"><code>&quot;273&quot;,&quot;Адрес ОФД&quot;,&quot;ofdp.platformaofd.ru&quot;
&quot;274&quot;,&quot;Порт ОФД&quot;,&quot;21101&quot;</code></pre>
<p>Сформировать файл с настройками можно как самостоятельно, так и выгрузить с ККТ, используя тест драйвера ККТ v.10. Для этого нужно зайти в <strong>Свойства</strong>, настроить связь с ККТ и зайти в <strong>Параметры ККТ</strong> и нажать <strong>Экспорт</strong> -&gt; <strong>Как CVS (для JPOS/OPOS)</strong>.</p>
<p>Автоматическая загрузка настроек происходит при вызове метода <strong>open()</strong>. Настройки из файла <strong>jpos.xml</strong> являются приоритетными. Например, значения настроек <strong>numHeaderLines</strong> и <strong>numTrailerLines</strong> перезатирают значения параметров <strong>№14</strong> и <strong>№35</strong>.</p>
<h3 id="выгрузка-настроек-из-ккт">Выгрузка настроек из ККТ</h3>
<p>При вызове метода <strong>open()</strong> может быть выполнена автоматическая выгрузка настроек ККТ в CSV-файл. Формат файла такой же, как при загрузке настроек в ККТ. Кодировка - <strong>UTF-8</strong>. Выгрузка регулируется параметрами:</p>
<ul>
<li><code>exportDeviceParametersFile</code> - путь к создаваемому файлу с настройками ККТ. При пустом значении выгрузка не выполняется.</li>
<li><p><code>exportDeviceParametersFilterFile</code> - путь к файлу с фильтром выгружаемых настроек ККТ. При пустом значении выгрузка не выполняется. Содержание данного файла задает фильтр следующим образом:</p>
<ul>
<li>Если файл содержит символ <code>*</code> - выгружаются все настройки (независимо от остального содержимого файла);</li>
<li>Если нет ни одного символа <code>*</code> - каждая строка файла должна содержать номер одного отдельного параметра, который требуется выгрузить. Если какая-либо строка файла не является числом, например, пустая или содержит не только цифры - она игнорируется;</li>
</ul></li>
</ul>
<p>Пример файла с фильтром (выгружаются все значения параметров):</p>
<pre class="csv"><code>*12345567890</code></pre>
<p>Пример файла с фильтром (выгружаются только значения параметров <strong>№273</strong> и <strong>№274</strong>):</p>
<pre class="csv"><code>273
274</code></pre>
<p>При вызове метода <strong>open()</strong> настройки сначала загружаются в ККТ всеми предусмотренными для этого способами, затем актуальные значения настроек выгружаются в файл.</p>
<h3 id="логирование">Логирование</h3>
<p>JPOS-драйвер для логирования использует библиотеку <strong>log4j</strong> версии <strong>1.2.17</strong>. Пример конфигурационного файла логирования (<em>log4j.properties</em>):</p>
<pre><code>log4j.logger.ru.atol=DEBUG, console, file

log4j.appender.console=org.apache.log4j.ConsoleAppender
log4j.appender.console.Target=System.out
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.conversionPattern=%d{yyyy-MM-dd HH\:mm\:ss\:SSS} %-5p {%t} [%c{1}] %m%n

log4j.appender.file=org.apache.log4j.DailyRollingFileAppender
log4j.appender.file.file=/var/log/atoljpos.log
log4j.appender.file.append=true
log4j.appender.file.datePattern=&#39;.&#39;yyyyMMdd
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.conversionPattern=%d{yyyy-MM-dd HH\:mm\:ss\:SSS} %-5p {%t} [%c{1}] %m%n</code></pre>                    
                </div>
            </div>
            <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>
        </div>
    </body>
</html>
